<Window
    Name="ThisWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    x:Class="InventorShaftGenerator.Views.MainWindow"
    xmlns:viewModels="clr-namespace:InventorShaftGenerator.ViewModels"
    xmlns:views="clr-namespace:InventorShaftGenerator.Views"
    xmlns:local="clr-namespace:InventorShaftGenerator"
    xmlns:sections="clr-namespace:InventorShaftGenerator.Models.Sections"
    xmlns:vc="clr-namespace:InventorShaftGenerator.ValueConverters"
    xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
    xmlns:ie="clr-namespace:Microsoft.Expression.Interactivity.Core;assembly=Microsoft.Expression.Interactions"
    xmlns:subFeatures="clr-namespace:InventorShaftGenerator.Models.SubFeatures"
    xmlns:behaviors="clr-namespace:InventorShaftGenerator.Behaviors"
    xmlns:models="clr-namespace:InventorShaftGenerator.Models"
    xmlns:reliefEnums="clr-namespace:InventorShaftGenerator.Models.EdgeFeatures.ReliefEnums"
    xmlns:edgeFeatures="clr-namespace:InventorShaftGenerator.Models.EdgeFeatures"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:mlex="clr-namespace:InventorShaftGenerator.MarkupExtensions"
    xmlns:infrastructure="clr-namespace:InventorShaftGenerator.Infrastructure"
    xmlns:ap="clr-namespace:InventorShaftGenerator.AttachedProperties"
    xmlns:preview2Dvc="clr-namespace:InventorShaftGenerator.ValueConverters.Preview2DValueConverters"
    xmlns:dimensionsViews="clr-namespace:InventorShaftGenerator.Views.SectionDimensionsWindows"
    xmlns:customUiElements="clr-namespace:InventorShaftGenerator.CustomizedUIElements"
    xmlns:extensions="clr-namespace:InventorShaftGenerator.Views.Extensions"
    mc:Ignorable="d"
    ResizeMode="NoResize"
    WindowStartupLocation="CenterScreen"
    Width="750" Height="550"
    Title="Shaft Component Generator"
    Icon="../Assets/Icons/shaft_16x16.ico">
    <Window.Resources>
        <ResourceDictionary>
            <viewModels:MainViewModel x:Key="MainViewModel" />
            <vc:SumConverter x:Key="SumConverter" />
            <vc:ParentCountConverter x:Key="ParentCountConverter" />
            <vc:ObjectToTypeConverter x:Key="ObjectToTypeConverter" />
            <vc:SectionFeatureToWindowTypeConverter x:Key="SectionFeatureToWindowTypeConverter" />
            <models:EdgeFeaturePosition x:Key="FirstEdgePosition">FirstEdge</models:EdgeFeaturePosition>
            <models:EdgeFeaturePosition x:Key="SecondEdgePosition">SecondEdge</models:EdgeFeaturePosition>
            <edgeFeatures:EdgeFeature x:Key="EdgeFeatureNotAvailable">NotAvailable</edgeFeatures:EdgeFeature>
            <vc:EdgeFeatureEnumMemberToNameConverter x:Key="EdgeFeatureEnumMemberToNameConverter" />
            <vc:SubFeatureEnumMemberToNameConverter x:Key="SubFeatureEnumMemberToNameConverter" />
            <vc:SubFeatureToNameConverter x:Key="SubFeatureToNameConverter" />
            <vc:EdgeFeatureToImageConverter x:Key="EdgeFeatureToImageConverter" />
            <vc:IsNotNullConverter x:Key="IsNotNullConverter" />
            <vc:TestConverter x:Key="TestConverter" />
            <vc:SectionComparer x:Key="SectionEqualityComparer" />
            <vc:AreEdgeFeaturesAvailableConverter x:Key="EdgeFeaturesAvailableConverter" />
            <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <infrastructure:Shaft x:Key="Shaft" />
            <sys:Double x:Key="{x:Static SystemParameters.VerticalScrollBarWidthKey}">15</sys:Double>
            <vc:MathConverter x:Key="MathConverter" />
            <vc:ChainConverter x:Key="ChainConverter" />
            <vc:ShaftItemToRemoveItemDialogWindowTypeConverter x:Key="ShaftItemToRemoveItemDialogWindowTypeConverter" />
            <vc:ObjectIsTypeOfConverter x:Key="ObjectIsTypeOfConverter" />
            <models:BoreFromEdge x:Key="BoreFromTheLeft">FromLeft</models:BoreFromEdge>
            <models:BoreFromEdge x:Key="BoreFromTheRight">FromRight</models:BoreFromEdge>
            <Style TargetType="{x:Type GroupBox}" x:Key="GroupBoxMainStyle">
                <Setter Property="BorderBrush" Value="DeepSkyBlue" />
                <Setter Property="Template" Value="{StaticResource GroupBoxCustomControlTemplate}" />
                <Setter Property="BorderThickness" Value="1.5" />
            </Style>
            <Style x:Key="DimensionsPanelStyle" TargetType="ListBox">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsDimensionsPanelEnabled}" Value="True">
                        <Setter Property="UIElement.Visibility" Value="Visible" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsDimensionsPanelEnabled}" Value="False">
                        <Setter Property="UIElement.Visibility" Value="Collapsed" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
            <Style x:Key="SectionsPanelStyle" BasedOn="{StaticResource GroupBoxMainStyle}" TargetType="GroupBox">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsDimensionsPanelEnabled}" Value="True">
                        <Setter Property="Grid.ColumnSpan" Value="1" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsDimensionsPanelEnabled}" Value="False">
                        <Setter Property="Grid.ColumnSpan" Value="2" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
            <Style x:Key="PlacementPanelStyle" BasedOn="{StaticResource GroupBoxMainStyle}" TargetType="GroupBox">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsDimensionsPanelEnabled}" Value="True">
                        <Setter Property="Grid.ColumnSpan" Value="1" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsDimensionsPanelEnabled}" Value="False">
                        <Setter Property="Grid.ColumnSpan" Value="2" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
            <Style x:Key="Preview2DGridStyle">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Is2DPreviewEnabled}" Value="True">
                        <Setter Property="UIElement.Visibility" Value="Visible" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Is2DPreviewEnabled}" Value="False">
                        <Setter Property="UIElement.Visibility" Value="Collapsed" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
            <Style x:Key="InstalledSectionsPanelStyle" BasedOn="{StaticResource TreeViewCustomStyle}"
                   TargetType="TreeView">
                <Setter Property="Grid.Row" Value="2" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding ElementName=Preview2DGrid, Path=Visibility}" Value="Visible">
                        <Setter Property="FrameworkElement.Margin" Value="0" />
                        <Setter Property="Grid.Row" Value="2" />
                        <Setter Property="Grid.RowSpan" Value="1" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding ElementName=Preview2DGrid, Path=Visibility}" Value="Collapsed">
                        <Setter Property="FrameworkElement.Margin" Value="0,3,0,0" />
                        <Setter Property="Grid.Row" Value="1" />
                        <Setter Property="Grid.RowSpan" Value="2" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
            <Style x:Key="SectionButtonsPanelStyle">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding ComboboxSelectedItem}" Value="Sections">
                        <Setter Property="UIElement.Visibility" Value="Visible" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding ComboboxSelectedItem}" Value="Bore on the left">
                        <Setter Property="UIElement.Visibility" Value="Collapsed" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding ComboboxSelectedItem}" Value="Bore on the right">
                        <Setter Property="UIElement.Visibility" Value="Collapsed" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
            <Style x:Key="BoreOnTheLeftButtonsPanelStyle">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding ComboboxSelectedItem}" Value="Sections">
                        <Setter Property="UIElement.Visibility" Value="Collapsed" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding ComboboxSelectedItem}" Value="Bore on the left">
                        <Setter Property="UIElement.Visibility" Value="Visible" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding ComboboxSelectedItem}" Value="Bore on the right">
                        <Setter Property="UIElement.Visibility" Value="Collapsed" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
            <Style x:Key="BoreOnTheRightButtonsPanelStyle">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding ComboboxSelectedItem}" Value="Sections">
                        <Setter Property="UIElement.Visibility" Value="Collapsed" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding ComboboxSelectedItem}" Value="Bore on the left">
                        <Setter Property="UIElement.Visibility" Value="Collapsed" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding ComboboxSelectedItem}" Value="Bore on the right">
                        <Setter Property="UIElement.Visibility" Value="Visible" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
            <Style TargetType="{x:Type Button}">
                <Setter Property="BorderBrush" Value="DeepSkyBlue" />
                <Setter Property="Background" Value="Transparent" />
            </Style>
            <Style x:Key="BorderMenuItemStyle" TargetType="Border">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="BorderThickness" Value="1" />
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#cbe8f6" />
                        <Setter Property="BorderBrush" Value="#26a0da" />
                    </Trigger>
                </Style.Triggers>
            </Style>
            <ControlTemplate x:Key="ButtonControlTemplate" TargetType="Button">
                <Border Name="border"
                        BorderThickness="0"
                        Padding="4,2"
                        BorderBrush="Transparent"
                        Background="Transparent">
                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter TargetName="border" Property="Background" Value="#F0FAFF" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
            <Style x:Key="ButtonStyle1" TargetType="Button">
                <Setter Property="OverridesDefaultStyle" Value="True" />
                <Setter Property="Template" Value="{StaticResource ButtonControlTemplate}" />
                <Style.Triggers>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter Property="BorderThickness" Value="0" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <vc:SwitchConverter
                x:Key="ReliefDinNameSelector">
                <vc:SwitchConverterCase When="ReliefA"
                                        Then="Relief-A (DIN)" />
                <vc:SwitchConverterCase When="ReliefB"
                                        Then="Relief-B (DIN)" />
                <vc:SwitchConverterCase When="ReliefC"
                                        Then="Relief-C (DIN)" />
                <vc:SwitchConverterCase When="ReliefD"
                                        Then="Relief-D (DIN)" />
                <vc:SwitchConverterCase When="ReliefE"
                                        Then="Relief-E (DIN)" />
                <vc:SwitchConverterCase When="ReliefF"
                                        Then="Relief-F (DIN)" />
            </vc:SwitchConverter>

            <vc:SwitchConverter
                x:Key="ReliefGostNameSelector">
                <vc:SwitchConverterCase When="ReliefA"
                                        Then="Relief-A (GOST)" />
                <vc:SwitchConverterCase When="ReliefB"
                                        Then="Relief-B (GOST)" />
                <vc:SwitchConverterCase When="ReliefC"
                                        Then="Relief-C (GOST)" />
                <vc:SwitchConverterCase When="ReliefD"
                                        Then="Relief-D (GOST)" />
                <vc:SwitchConverterCase When="ReliefE"
                                        Then="Relief-E (GOST)" />
            </vc:SwitchConverter>

            <vc:SwitchConverter
                x:Key="ReliefSiNameSelector">
                <vc:SwitchConverterCase When="ReliefA"
                                        Then="Relief-A (SI)" />
                <vc:SwitchConverterCase When="ReliefB"
                                        Then="Relief-B (SI)" />
                <vc:SwitchConverterCase When="ReliefF"
                                        Then="Relief-F (SI)" />
                <vc:SwitchConverterCase When="ReliefG"
                                        Then="Relief-G (SI)" />
            </vc:SwitchConverter>

            <ContextMenu x:Key="FirstEdgeContextMenu" FontSize="11"
                         Name="FirstEdgeContextMenu"
                         ItemsSource="{Binding AvailableFirstEdgeFeatures}" x:Shared="False">
                <ContextMenu.ItemContainerStyle>
                    <Style TargetType="MenuItem">
                        <Setter Property="ItemsPanel">
                            <Setter.Value>
                                <ItemsPanelTemplate>
                                    <StackPanel Background="White" />
                                </ItemsPanelTemplate>
                            </Setter.Value>
                        </Setter>
                        <Setter Property="Command"
                                Value="{Binding Source={StaticResource MainViewModel}, Path=SetEdgeFeatureCommand}" />
                        <Setter Property="CommandParameter" Value="{Binding}" />
                        <Style.Triggers>
                            <DataTrigger
                                Binding="{Binding}"
                                Value="ReliefSI">
                                <Setter Property="ItemsSource"
                                        Value="{Binding Source={mlex:EnumBindingSource {x:Type reliefEnums:ReliefSIFeature}}}" />
                                <Setter Property="ItemContainerStyle">
                                    <Setter.Value>
                                        <Style TargetType="MenuItem">
                                            <Setter Property="Command"
                                                    Value="{Binding Source={StaticResource MainViewModel}, Path=SetEdgeFeatureCommand}" />
                                            <Setter Property="CommandParameter"
                                                    Value="{Binding}" />
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Border
                                                            Style="{StaticResource BorderMenuItemStyle}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition
                                                                        Width="0.2*" />
                                                                    <ColumnDefinition
                                                                        Width="0.8*" />
                                                                </Grid.ColumnDefinitions>
                                                                <Image
                                                                    Grid.Column="0"
                                                                    VerticalAlignment="Center"
                                                                    Height="27"
                                                                    Width="27">
                                                                    <Image.Style>
                                                                        <Style TargetType="Image">
                                                                            <Style.Triggers>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefA">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefASiIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefB">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefBSiIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefF">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefFSiIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefG">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefGSiIcon.png" />
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Image.Style>
                                                                </Image>
                                                                <TextBlock
                                                                    Grid.Column="1"
                                                                    Text="{Binding Converter={StaticResource ReliefSiNameSelector}}"
                                                                    VerticalAlignment="Center"
                                                                    Margin="2,0,8,0" />
                                                            </Grid>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <DataTrigger
                                Binding="{Binding}"
                                Value="ReliefDIN">
                                <Setter Property="ItemsSource"
                                        Value="{Binding Source={mlex:EnumBindingSource {x:Type reliefEnums:ReliefDINFeature}}}" />
                                <Setter Property="ItemContainerStyle">
                                    <Setter.Value>
                                        <Style TargetType="MenuItem">
                                            <Setter Property="Command"
                                                    Value="{Binding Source={StaticResource MainViewModel}, 
                                                                                    Path=SetEdgeFeatureCommand}" />
                                            <Setter Property="CommandParameter"
                                                    Value="{Binding}" />
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Border
                                                            Style="{StaticResource BorderMenuItemStyle}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition
                                                                        Width="0.2*" />
                                                                    <ColumnDefinition
                                                                        Width="0.8*" />
                                                                </Grid.ColumnDefinitions>
                                                                <Image
                                                                    Grid.Column="0"
                                                                    VerticalAlignment="Center"
                                                                    Height="27"
                                                                    Width="27">
                                                                    <Image.Style>
                                                                        <Style TargetType="Image">
                                                                            <Style.Triggers>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefA">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefADinIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefB">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefBDinIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefC">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefCDinIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefD">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefDDinIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefE">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefEDinIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefF">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefFDinIcon.png" />
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Image.Style>
                                                                </Image>
                                                                <TextBlock
                                                                    Grid.Column="1"
                                                                    VerticalAlignment="Center"
                                                                    Margin="2,0,8,0"
                                                                    Text="{Binding Converter={StaticResource ReliefDinNameSelector}}" />
                                                            </Grid>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <DataTrigger
                                Binding="{Binding}"
                                Value="ReliefGOST">
                                <Setter Property="ItemsSource"
                                        Value="{Binding Source={mlex:EnumBindingSource {x:Type reliefEnums:ReliefGOSTFeature}}}" />
                                <Setter Property="ItemContainerStyle">
                                    <Setter.Value>
                                        <Style TargetType="MenuItem">
                                            <Setter Property="Command"
                                                    Value="{Binding Source={StaticResource MainViewModel}, 
                                                                                    Path=SetEdgeFeatureCommand}" />
                                            <Setter Property="CommandParameter"
                                                    Value="{Binding}" />
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Border
                                                            Style="{StaticResource BorderMenuItemStyle}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition
                                                                        Width="0.2*" />
                                                                    <ColumnDefinition
                                                                        Width="0.8*" />
                                                                </Grid.ColumnDefinitions>
                                                                <Image
                                                                    Grid.Column="0"
                                                                    VerticalAlignment="Center"
                                                                    Height="27"
                                                                    Width="27">
                                                                    <Image.Style>
                                                                        <Style TargetType="Image">
                                                                            <Style.Triggers>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefA">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefAGostIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefB">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefBGostIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefC">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefCGostIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefD">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefDGostIcon.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefE">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefEGostIcon.png" />
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Image.Style>
                                                                </Image>
                                                                <TextBlock
                                                                    Grid.Column="1"
                                                                    Text="{Binding Converter={StaticResource ReliefGostNameSelector}}"
                                                                    VerticalAlignment="Center"
                                                                    Margin="2,0,8,0" />
                                                            </Grid>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContextMenu.ItemContainerStyle>
                <ContextMenu.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Background="White" />
                    </ItemsPanelTemplate>
                </ContextMenu.ItemsPanel>
                <ContextMenu.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="-25,0,-40,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="0.2*" />
                                <ColumnDefinition Width="0.8*" />
                            </Grid.ColumnDefinitions>
                            <Image Grid.Column="0"
                                   VerticalAlignment="Center"
                                   Height="27" Width="27">
                                <Image.Style>
                                    <Style TargetType="Image">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="None">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/noneFeatureIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="Chamfer">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/chamferIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="Fillet">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/filletIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="Thread">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/threadIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="LockNutGroove">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/lockNutIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="PlainKeywayGroove">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/plainKeywayGrooveIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="KeywayGrooveRoundedEnd">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/keywayGrooveRoundEndIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="ReliefSI">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/reliefASiIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="ReliefDIN">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/reliefADinIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="ReliefGOST">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/reliefAGostIcon.png" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                            <TextBlock Grid.Column="1"
                                       Text="{Binding Converter={StaticResource EdgeFeatureEnumMemberToNameConverter}}"
                                       VerticalAlignment="Center" Margin="2,0,8,0" />
                        </Grid>
                    </DataTemplate>
                </ContextMenu.ItemTemplate>
            </ContextMenu>

            <ContextMenu x:Key="SecondEdgeContextMenu" FontSize="11"
                         Name="SecondEdgeContextMenu"
                         ItemsSource="{Binding AvailableSecondEdgeFeatures}" x:Shared="False">
                <ContextMenu.ItemContainerStyle>
                    <Style TargetType="MenuItem">
                        <Setter Property="ItemsPanel">
                            <Setter.Value>
                                <ItemsPanelTemplate>
                                    <StackPanel Background="White" />
                                </ItemsPanelTemplate>
                            </Setter.Value>
                        </Setter>
                        <Setter Property="Command"
                                Value="{Binding Source={StaticResource MainViewModel}, Path=SetEdgeFeatureCommand}" />
                        <Setter Property="CommandParameter" Value="{Binding}" />
                        <Style.Triggers>
                            <DataTrigger
                                Binding="{Binding}"
                                Value="ReliefSI">
                                <Setter Property="ItemsSource"
                                        Value="{Binding Source={mlex:EnumBindingSource {x:Type reliefEnums:ReliefSIFeature}}}" />
                                <Setter Property="ItemContainerStyle">
                                    <Setter.Value>
                                        <Style TargetType="MenuItem">
                                            <Setter Property="Command"
                                                    Value="{Binding Source={StaticResource MainViewModel}, Path=SetEdgeFeatureCommand}" />
                                            <Setter Property="CommandParameter"
                                                    Value="{Binding}" />
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Border
                                                            Style="{StaticResource BorderMenuItemStyle}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition
                                                                        Width="0.2*" />
                                                                    <ColumnDefinition
                                                                        Width="0.8*" />
                                                                </Grid.ColumnDefinitions>
                                                                <Image
                                                                    Grid.Column="0"
                                                                    VerticalAlignment="Center"
                                                                    Height="27"
                                                                    Width="27">
                                                                    <Image.Style>
                                                                        <Style TargetType="Image">
                                                                            <Style.Triggers>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefA">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefASiIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefB">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefBSiIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefF">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefFSiIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefG">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefGSiIconFlip.png" />
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Image.Style>
                                                                </Image>
                                                                <TextBlock
                                                                    Grid.Column="1"
                                                                    Text="{Binding Converter={StaticResource ReliefSiNameSelector}}"
                                                                    VerticalAlignment="Center"
                                                                    Margin="2,0,8,0" />
                                                            </Grid>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <DataTrigger
                                Binding="{Binding}"
                                Value="ReliefDIN">
                                <Setter Property="ItemsSource"
                                        Value="{Binding Source={mlex:EnumBindingSource {x:Type reliefEnums:ReliefDINFeature}}}" />
                                <Setter Property="ItemContainerStyle">
                                    <Setter.Value>
                                        <Style TargetType="MenuItem">
                                            <Setter Property="Command"
                                                    Value="{Binding Source={StaticResource MainViewModel}, 
                                                                                    Path=SetEdgeFeatureCommand}" />
                                            <Setter Property="CommandParameter"
                                                    Value="{Binding}" />
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Border
                                                            Style="{StaticResource BorderMenuItemStyle}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition
                                                                        Width="0.2*" />
                                                                    <ColumnDefinition
                                                                        Width="0.8*" />
                                                                </Grid.ColumnDefinitions>
                                                                <Image
                                                                    Grid.Column="0"
                                                                    VerticalAlignment="Center"
                                                                    Height="27"
                                                                    Width="27">
                                                                    <Image.Style>
                                                                        <Style TargetType="Image">
                                                                            <Style.Triggers>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefA">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefADinIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefB">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefBDinIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefC">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefCDinIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefD">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefDDinIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefE">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefEDinIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefF">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefFDinIconFlip.png" />
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Image.Style>
                                                                </Image>
                                                                <TextBlock
                                                                    Grid.Column="1"
                                                                    Text="{Binding Converter={StaticResource ReliefDinNameSelector}}"
                                                                    VerticalAlignment="Center"
                                                                    Margin="2,0,8,0" />
                                                            </Grid>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                            <DataTrigger
                                Binding="{Binding}"
                                Value="ReliefGOST">
                                <Setter Property="ItemsSource"
                                        Value="{Binding Source={mlex:EnumBindingSource {x:Type reliefEnums:ReliefGOSTFeature}}}" />
                                <Setter Property="ItemContainerStyle">
                                    <Setter.Value>
                                        <Style TargetType="MenuItem">
                                            <Setter Property="Command"
                                                    Value="{Binding Source={StaticResource MainViewModel}, 
                                                                                    Path=SetEdgeFeatureCommand}" />
                                            <Setter Property="CommandParameter"
                                                    Value="{Binding}" />
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <Border
                                                            Style="{StaticResource BorderMenuItemStyle}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition
                                                                        Width="0.2*" />
                                                                    <ColumnDefinition
                                                                        Width="0.8*" />
                                                                </Grid.ColumnDefinitions>
                                                                <Image
                                                                    Grid.Column="0"
                                                                    VerticalAlignment="Center"
                                                                    Height="27"
                                                                    Width="27">
                                                                    <Image.Style>
                                                                        <Style TargetType="Image">
                                                                            <Style.Triggers>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefA">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefAGostIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefB">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefBGostIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefC">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefCGostIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefD">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefDGostIconFlip.png" />
                                                                                </DataTrigger>
                                                                                <DataTrigger
                                                                                    Binding="{Binding}"
                                                                                    Value="ReliefE">
                                                                                    <Setter
                                                                                        Property="Source"
                                                                                        Value="../Assets/Icons/reliefEGostIconFlip.png" />
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Image.Style>
                                                                </Image>
                                                                <TextBlock
                                                                    Grid.Column="1"
                                                                    Text="{Binding Converter={StaticResource ReliefGostNameSelector}}"
                                                                    VerticalAlignment="Center"
                                                                    Margin="2,0,8,0" />
                                                            </Grid>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContextMenu.ItemContainerStyle>
                <ContextMenu.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Background="White" />
                    </ItemsPanelTemplate>
                </ContextMenu.ItemsPanel>
                <ContextMenu.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="-25,0,-40,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="0.2*" />
                                <ColumnDefinition Width="0.8*" />
                            </Grid.ColumnDefinitions>
                            <Image Grid.Column="0"
                                   VerticalAlignment="Center"
                                   Height="27" Width="27">
                                <Image.Style>
                                    <Style TargetType="Image">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="None">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/noneFeatureIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="Chamfer">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/chamferIconFlip.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="Fillet">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/filletIconFlip.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="Thread">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/threadIconFlip.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="LockNutGroove">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/lockNutIconFlip.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="PlainKeywayGroove">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/plainKeywayGrooveIconFlip.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="KeywayGrooveRoundedEnd">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/keywayGrooveRoundEndIconFlip.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="ReliefSI">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/reliefASiIconFlip.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="ReliefDIN">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/reliefADinIconFlip.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="ReliefGOST">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/reliefAGostIconFlip.png" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                            <TextBlock Grid.Column="1"
                                       Text="{Binding Converter={StaticResource EdgeFeatureEnumMemberToNameConverter}}"
                                       VerticalAlignment="Center" Margin="2,0,8,0" />
                        </Grid>
                    </DataTemplate>
                </ContextMenu.ItemTemplate>
            </ContextMenu>

            <ContextMenu x:Key="SectionsContextMenu" FontSize="11"
                         x:Shared="False">
                <ContextMenu.Resources>
                    <x:Array x:Key="BoreSections" Type="models:Section">
                        <models:Section>Cylinder</models:Section>
                        <models:Section>Cone</models:Section>
                    </x:Array>
                    <x:Array x:Key="ShaftSecitons" Type="models:Section">
                        <models:Section>Cylinder</models:Section>
                        <models:Section>Cone</models:Section>
                        <models:Section>Polygon</models:Section>
                    </x:Array>
                </ContextMenu.Resources>
                <ContextMenu.Style>
                    <Style TargetType="ContextMenu">
                        <Setter Property="ItemsSource" Value="{StaticResource BoreSections}" />
                        <Style.Triggers>
                            <DataTrigger
                                Binding="{Binding Source={StaticResource MainViewModel}, Path=ComboboxSelectedItem}"
                                Value="Sections">
                                <Setter Property="ItemsSource" Value="{StaticResource ShaftSecitons}" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContextMenu.Style>
                <ContextMenu.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Background="White" />
                    </ItemsPanelTemplate>
                </ContextMenu.ItemsPanel>
                <ContextMenu.ItemContainerStyle>
                    <Style TargetType="MenuItem">
                        <Setter Property="Command"
                                Value="{Binding Source={StaticResource MainViewModel}, Path=ReplaceSectionCommand}" />
                        <Setter Property="CommandParameter" Value="{Binding}" />
                    </Style>
                </ContextMenu.ItemContainerStyle>
                <ContextMenu.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="-25,0,-40,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="0.2*" />
                                <ColumnDefinition Width="0.8*" />
                            </Grid.ColumnDefinitions>
                            <Image Grid.Column="0"
                                   VerticalAlignment="Center"
                                   Height="27" Width="27">
                                <Image.Style>
                                    <Style TargetType="Image">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="Cylinder">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/cylinderIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="Cone">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/coneIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="Polygon">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/poligoneIconS.png" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                            <TextBlock Grid.Column="1"
                                       Text="{Binding}"
                                       VerticalAlignment="Center" Margin="2,0,8,0" />
                        </Grid>
                    </DataTemplate>
                </ContextMenu.ItemTemplate>
            </ContextMenu>

            <ContextMenu x:Key="SubFeatureContextMenu" FontSize="11" x:Shared="False" Name="SubFeatureContextMenu">
                <ContextMenu.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Background="White" />
                    </ItemsPanelTemplate>
                </ContextMenu.ItemsPanel>
                <ContextMenu.ItemContainerStyle>
                    <Style TargetType="MenuItem">
                        <Setter Property="Command"
                                Value="{Binding Source={StaticResource MainViewModel}, Path=AddSubFeatureCommand}" />
                        <Setter Property="CommandParameter" Value="{Binding}" />
                    </Style>
                </ContextMenu.ItemContainerStyle>
                <ContextMenu.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="-25,0,-40,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="0.2*" />
                                <ColumnDefinition Width="0.8*" />
                            </Grid.ColumnDefinitions>
                            <Image Grid.Column="0"
                                   VerticalAlignment="Center"
                                   Height="27" Width="27">
                                <Image.Style>
                                    <Style TargetType="Image">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="ThroughHole">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/throughHoleIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="RetainingRingGroove">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/retainingRingIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="KeywayGroove">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/keywayGrooveFeatureIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="Wrench">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/wrenchOpeningIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="ReliefDSI">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/reliefDIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="GrooveA">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/grooveAIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}"
                                                         Value="GrooveB">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/grooveBIcon.png" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding}" Value="RetainingRingBore">
                                                <Setter Property="Source" Value="../Assets/Icons/retainingRingBore.png" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                            <TextBlock Grid.Column="1"
                                       Text="{Binding Converter={StaticResource SubFeatureEnumMemberToNameConverter}}"
                                       VerticalAlignment="Center" Margin="2,0,8,0" />
                        </Grid>
                    </DataTemplate>
                </ContextMenu.ItemTemplate>
            </ContextMenu>

            <Style x:Key="OpenContextMenuButtonStyle" x:Shared="False" TargetType="Button">
                <Setter Property="Background" Value="#00ABFF" />
                <Setter Property="Width" Value="12" />
                <Setter Property="Height" Value="30" />
                <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Grid Width="{TemplateBinding Width}"
                                  Height="{TemplateBinding Height}"
                                  Background="{TemplateBinding Background}">
                                <Path Data="M -1 -2 L 4 3 L -1 8 Z"
                                      Fill="White" HorizontalAlignment="Center"
                                      VerticalAlignment="Center" />
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>


            <Button x:Key="FirstEdgeContextMenuButton" x:Shared="False" Name="TestButton"
                    behaviors:SectionFeatureContextMenuBehavior.IsFeatureAvailable="{Binding AvailableFirstEdgeFeatures[0]}"
                    behaviors:SectionFeatureContextMenuBehavior.ContextMenu="{StaticResource FirstEdgeContextMenu}"
                    behaviors:SectionFeatureContextMenuBehavior.PlacementAt="{Binding ElementName=FirstEdgeFeatureBorder}"
                    behaviors:SectionFeatureContextMenuBehavior.DataContext="{StaticResource MainViewModel}"
                    behaviors:SectionFeatureContextMenuBehavior.Section="{Binding}"
                    Style="{StaticResource OpenContextMenuButtonStyle}" />

            <Button x:Key="SectionsContextMenuButton" x:Shared="False"
                    behaviors:SectionFeatureContextMenuBehavior.ContextMenu="{StaticResource SectionsContextMenu}"
                    behaviors:SectionFeatureContextMenuBehavior.PlacementAt="{Binding ElementName=SectionsBorder}"
                    behaviors:SectionFeatureContextMenuBehavior.DataContext="{StaticResource MainViewModel}"
                    behaviors:SectionFeatureContextMenuBehavior.Section="{Binding}"
                    Style="{StaticResource OpenContextMenuButtonStyle}" />

            <Button x:Key="SecondEdgeContextMenuButton" x:Shared="False"
                    behaviors:SectionFeatureContextMenuBehavior.IsFeatureAvailable="{Binding AvailableSecondEdgeFeatures[0]}"
                    behaviors:SectionFeatureContextMenuBehavior.ContextMenu="{StaticResource SecondEdgeContextMenu}"
                    behaviors:SectionFeatureContextMenuBehavior.PlacementAt="{Binding ElementName=SecondEdgeFeatureBorder}"
                    behaviors:SectionFeatureContextMenuBehavior.DataContext="{StaticResource MainViewModel}"
                    behaviors:SectionFeatureContextMenuBehavior.Section="{Binding}"
                    Style="{StaticResource OpenContextMenuButtonStyle}" />

            <Button x:Key="SubFeatureContextMenuButton" x:Shared="False"
                    behaviors:SectionFeatureContextMenuBehavior.ContextMenu="{StaticResource SubFeatureContextMenu}"
                    behaviors:SectionFeatureContextMenuBehavior.PlacementAt="{Binding ElementName=SubFeatureBorder}"
                    behaviors:SectionFeatureContextMenuBehavior.DataContext="{StaticResource MainViewModel}"
                    behaviors:SectionFeatureContextMenuBehavior.Section="{Binding}"
                    Style="{StaticResource OpenContextMenuButtonStyle}" />

            <vc:ShaftItemToParametersWindowTypeConverter x:Key="ShaftItemToParametersWindowTypeConverter" />

            <Button x:Key="OpenParametersDialogButton" x:Shared="False" BorderThickness="0" FocusVisualStyle="{x:Null}"
                    ToolTip="Open a parameters dialog">
                <StackPanel>
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="MouseLeftButtonDown">
                            <i:InvokeCommandAction
                                Command="{Binding Source={StaticResource MainViewModel}, Path=SetSelectedSectionCommand}"
                                CommandParameter="{Binding}"
                                IsEnabled="{Binding Converter={StaticResource ObjectIsTypeOfConverter}, 
                                ConverterParameter={x:Type models:ShaftSection}}" />
                            <i:InvokeCommandAction
                                Command="{Binding Source={StaticResource MainViewModel}, Path=SetSelectedSubFeatureCommand}"
                                CommandParameter="{Binding}"
                                IsEnabled="{Binding Converter={StaticResource ObjectIsTypeOfConverter}, 
                                ConverterParameter={x:Type models:ISectionFeature}}" />
                            <i:InvokeCommandAction
                                Command="{Binding Source={StaticResource MainViewModel}, 
                                            Path=OpenDialogViewCommand}"
                                CommandParameter="{Binding Converter={StaticResource ShaftItemToParametersWindowTypeConverter}}" />
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                    <Image Source="../Assets/Icons/openDialog.png" Width="14px" Height="15px"
                           Stretch="Fill" />
                </StackPanel>
            </Button>

            <Button x:Key="RemoveItemButton" x:Shared="False" BorderThickness="0" FocusVisualStyle="{x:Null}"
                    ToolTip="Remove the item">
                <StackPanel>
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="MouseLeftButtonDown">
                            <i:InvokeCommandAction
                                Command="{Binding Source={StaticResource MainViewModel}, Path=SetSelectedSectionCommand}"
                                CommandParameter="{Binding}"
                                IsEnabled="{Binding Converter={StaticResource ObjectIsTypeOfConverter}, 
                                ConverterParameter={x:Type models:ShaftSection}}" />
                            <i:InvokeCommandAction
                                Command="{Binding Source={StaticResource MainViewModel}, Path=SetSelectedSectionCommand}"
                                CommandParameter="{Binding LinkedSection}"
                                IsEnabled="{Binding Converter={StaticResource ObjectIsTypeOfConverter}, 
                                ConverterParameter={x:Type subFeatures:ISectionSubFeature}}" />
                            <i:InvokeCommandAction
                                Command="{Binding Source={StaticResource MainViewModel}, Path=SetSelectedSubFeatureCommand}"
                                CommandParameter="{Binding}"
                                IsEnabled="{Binding Converter={StaticResource ObjectIsTypeOfConverter}, 
                                ConverterParameter={x:Type models:ISectionFeature}}" />
                            <i:InvokeCommandAction
                                Command="{Binding Source={StaticResource MainViewModel}, Path=OpenDialogViewCommand}"
                                CommandParameter="{Binding Converter={StaticResource ShaftItemToRemoveItemDialogWindowTypeConverter}}" />
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                    <Image Source="../Assets/Icons/deleteItem.png" Width="14px" Height="14px"
                           Stretch="Fill" />
                </StackPanel>
            </Button>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="CustomStyles.xaml" />
                <ResourceDictionary Source="Extensions/BusyDecoratorStyle.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>
    <Window.DataContext>
        <StaticResource ResourceKey="MainViewModel" />
    </Window.DataContext>
    <extensions:BusyDecorator x:Name="BusyIndicator">
        <Grid Margin="0,0,3.4,-0.2" Name="MainGrid">
            <Grid.RowDefinitions>
                <!--<RowDefinition Height="0.12*" />-->
                <RowDefinition Height="0.8*" />
                <RowDefinition Height="0.08*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="0.75*" />
                <ColumnDefinition Width="0.25*" />
            </Grid.ColumnDefinitions>
            <!--  -->
            <!-- Placement GroupBox -->
            <!--  -->
            <!--
        <GroupBox Grid.Row="0" Grid.Column="0" Margin="5,5,5,2" Padding="10,0,0,0" Header="Placement"
                  Name="PlacementGroupBox" Style="{StaticResource PlacementPanelStyle}">
            <DockPanel>
                <Button HorizontalAlignment="Left" VerticalAlignment="Center" BorderThickness="0"
                        FocusVisualStyle="{x:Null}">
                    <DockPanel LastChildFill="True">
                        <Image DockPanel.Dock="Left" Source="../Assets/Icons/posA.png" Stretch="Fill" Width="37px"
                               Height="25px" />
                        <TextBlock HorizontalAlignment="Right" VerticalAlignment="Center" Margin="2,0,0,0" Text="Axis" />
                    </DockPanel>
                </Button>
                <Button HorizontalAlignment="Left" VerticalAlignment="Center" BorderThickness="0" Margin="30,0,0,0"
                        FocusVisualStyle="{x:Null}">
                    <DockPanel LastChildFill="True">
                        <Image DockPanel.Dock="Left" Source="../Assets/Icons/posB.png" Stretch="Fill" Width="37px"
                               Height="25px" />
                        <TextBlock HorizontalAlignment="Right" VerticalAlignment="Center" Margin="2,0,0,0"
                                   Text="Start plane" />
                    </DockPanel>
                </Button>
                <TextBlock Text="{Binding SelectedSection.Id}" />
            </DockPanel>
        </GroupBox>
-->
            <!--  -->
            <!-- Sections GroupBox -->
            <!--  -->
            <GroupBox Grid.Row="0" Grid.Column="0" Padding="1" Header="Sections" Margin="5,0,5,1"
                      Name="SectionsGroupBox"
                      Style="{StaticResource SectionsPanelStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="0.08*" />
                        <RowDefinition Height="0.35*" />
                        <RowDefinition Height="0.57*" />
                    </Grid.RowDefinitions>
                    <DockPanel Grid.Row="0">
                        <DockPanel.Resources>
                            <Style BasedOn="{StaticResource ButtonStyle1}" TargetType="Button" x:Key="BoreButtonStyle">
                                <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                                <Setter Property="OverridesDefaultStyle" Value="True" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Source={StaticResource Shaft}, Path=Sections.Count}"
                                                 Value="0">
                                        <Setter Property="IsEnabled" Value="False" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DockPanel.Resources>
                        <StackPanel Orientation="Horizontal">
                            <ComboBox Name="SectionsComboBox" Height="20" Width="160"
                                      Style="{DynamicResource ComboBoxCustomStyle}"
                                      FontSize="11"
                                      SelectedIndex="0"
                                      SelectedValue="{Binding ComboboxSelectedItem, Mode=TwoWay}">
                                <ComboBox.ItemsSource>
                                    <x:Array Type="sys:String">
                                        <sys:String>Sections</sys:String>
                                        <sys:String>Bore on the left</sys:String>
                                        <sys:String>Bore on the right</sys:String>
                                    </x:Array>
                                </ComboBox.ItemsSource>
                            </ComboBox>
                            <DockPanel Name="SectionButtonsPanel" Style="{StaticResource SectionButtonsPanelStyle}">
                                <Button HorizontalAlignment="Left" VerticalAlignment="Center"
                                        Style="{StaticResource ButtonStyle1}"
                                        ToolTip="Insert a cylinder" BorderThickness="0" Margin="5,0,0,0"
                                        Command="{Binding InsertCylinderCommand}" FocusVisualStyle="{x:Null}">
                                    <Image Source="../Assets/Icons/insertCylinder.png" Width="27" Height="27"
                                           Stretch="Fill" />
                                </Button>
                                <Button HorizontalAlignment="Left" VerticalAlignment="Center"
                                        Style="{StaticResource ButtonStyle1}"
                                        ToolTip="Split the selected section" BorderThickness="0" Margin="5,0,0,0"
                                        Command="{Binding SplitSelectedSectionCommand}"
                                        CommandParameter="{x:Type dimensionsViews:SplitCylinderWindow}"
                                        FocusVisualStyle="{x:Null}"
                                        Background="Transparent">
                                    <Image Width="27" Height="27"
                                           Stretch="Fill">
                                        <Image.Style>
                                            <Style TargetType="Image">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/splitSelectedSection.png" />
                                                <Style.Triggers>
                                                    <Trigger Property="IsEnabled" Value="False">
                                                        <Setter Property="Source">
                                                            <Setter.Value>
                                                                <FormatConvertedBitmap
                                                                    Source="../Assets/Icons/splitSelectedSection.png"
                                                                    DestinationFormat="Gray32Float" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>
                                </Button>
                                <Button HorizontalAlignment="Left" VerticalAlignment="Center"
                                        Style="{StaticResource ButtonStyle1}"
                                        ToolTip="Insert a cone" BorderThickness="0" Margin="5,0,0,0"
                                        Command="{Binding InsertConeCommand}" FocusVisualStyle="{x:Null}">
                                    <Image Source="../Assets/Icons/insertCone.png " Width="27" Height="27"
                                           Stretch="Fill" />
                                </Button>
                                <Button HorizontalAlignment="Left" VerticalAlignment="Center"
                                        Style="{StaticResource ButtonStyle1}"
                                        ToolTip="Insert a polygon" BorderThickness="0" Margin="5,0,0,0"
                                        Command="{Binding InsertPolygonCommand}" FocusVisualStyle="{x:Null}">
                                    <Image Source="../Assets/Icons/insertPolygon.png" Width="27" Height="27"
                                           Stretch="Fill" />
                                </Button>
                            </DockPanel>
                            <DockPanel Name="BoreOnTheLeftButtonsPanel"
                                       Style="{StaticResource BoreOnTheLeftButtonsPanelStyle}">
                                <Button HorizontalAlignment="Left" VerticalAlignment="Center"
                                        ToolTip="Insert a cylindrical bore" BorderThickness="0" Margin="5,0,0,0"
                                        Command="{Binding InsertCylindricalBoreCommand}"
                                        CommandParameter="{StaticResource BoreFromTheLeft}"
                                        Style="{StaticResource BoreButtonStyle}">
                                    <Image Width="27" Height="27"
                                           Stretch="Fill">
                                        <Image.Style>
                                            <Style TargetType="Image">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/insertCylinderBoreLeft.png" />
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=IsEnabled}"
                                                        Value="False">
                                                        <Setter Property="Source">
                                                            <Setter.Value>
                                                                <FormatConvertedBitmap
                                                                    Source="../Assets/Icons/insertCylinderBoreLeft.png"
                                                                    DestinationFormat="Gray32Float" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>
                                </Button>
                                <Button HorizontalAlignment="Left" VerticalAlignment="Center"
                                        ToolTip="Insert a conical bore" BorderThickness="0" Margin="5,0,0,0"
                                        Command="{Binding InsertConicalBoreCommand}"
                                        CommandParameter="{StaticResource BoreFromTheLeft}"
                                        Style="{StaticResource BoreButtonStyle}">
                                    <Image Width="27" Height="27"
                                           Stretch="Fill">
                                        <Image.Style>
                                            <Style TargetType="Image">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/insertConicalBoreLeft.png" />
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=IsEnabled}"
                                                        Value="False">
                                                        <Setter Property="Source">
                                                            <Setter.Value>
                                                                <FormatConvertedBitmap
                                                                    Source="../Assets/Icons/insertConicalBoreLeft.png"
                                                                    DestinationFormat="Gray32Float" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>
                                </Button>
                            </DockPanel>
                            <DockPanel Name="BoreOnTheRightButtonsPanel"
                                       Style="{StaticResource BoreOnTheRightButtonsPanelStyle}">
                                <Button HorizontalAlignment="Left" VerticalAlignment="Center"
                                        ToolTip="Insert a cylindrical bore" BorderThickness="0" Margin="5,0,0,0"
                                        Command="{Binding InsertCylindricalBoreCommand}"
                                        CommandParameter="{StaticResource BoreFromTheRight}"
                                        Style="{StaticResource BoreButtonStyle}">
                                    <Image Width="27" Height="27"
                                           Stretch="Fill">
                                        <Image.Style>
                                            <Style TargetType="Image">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/insertCylinderBoreRight.png" />
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=IsEnabled}"
                                                        Value="False">
                                                        <Setter Property="Source">
                                                            <Setter.Value>
                                                                <FormatConvertedBitmap
                                                                    Source="../Assets/Icons/insertCylinderBoreRight.png"
                                                                    DestinationFormat="Gray32Float" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>
                                </Button>
                                <Button HorizontalAlignment="Left" VerticalAlignment="Center"
                                        ToolTip="Insert a conical bore" BorderThickness="0" Margin="5,0,0,2"
                                        Command="{Binding InsertConicalBoreCommand}"
                                        CommandParameter="{StaticResource BoreFromTheRight}"
                                        Style="{StaticResource BoreButtonStyle}">
                                    <Image Width="27" Height="27"
                                           Stretch="Fill">
                                        <Image.Style>
                                            <Style TargetType="Image">
                                                <Setter Property="Source"
                                                        Value="../Assets/Icons/insertConicalBoreRight.png" />
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=IsEnabled}"
                                                        Value="False">
                                                        <Setter Property="Source">
                                                            <Setter.Value>
                                                                <FormatConvertedBitmap
                                                                    Source="../Assets/Icons/insertConicalBoreRight.png"
                                                                    DestinationFormat="Gray32Float" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>

                                    </Image>
                                </Button>
                            </DockPanel>
                            <DockPanel Name="OptionsPanel">
                                <Line X1="0" X2="0" Y1="5" Y2="30" Stroke="DeepSkyBlue" StrokeThickness="1.5"
                                      Margin="5,0,5,0" />
                                <Button HorizontalAlignment="Left" VerticalAlignment="Center"
                                        BorderThickness="0"
                                        Command="{Binding ExpandOrCollapseAllChildrenCommand}"
                                        FocusVisualStyle="{x:Null}">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource ButtonStyle1}">
                                            <Setter Property="Background" Value="Transparent" />
                                            <Setter Property="ToolTip" Value="Expand all children" />
                                            <Style.Triggers>
                                                <DataTrigger
                                                    Binding="{Binding Source={StaticResource MainViewModel}, Path=AllChildrenExpanded}"
                                                    Value="True">
                                                    <Setter Property="ToolTip" Value="Collapse all children" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                    <Image Width="27" Height="27"
                                           Stretch="Fill">
                                        <Image.Style>
                                            <Style TargetType="Image">
                                                <Setter Property="Source" Value="../Assets/Icons/expandChildren.png" />
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding Source={StaticResource MainViewModel}, Path=AllChildrenExpanded}"
                                                        Value="True">
                                                        <Setter Property="Source"
                                                                Value="../Assets/Icons/collapseChildren.png" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>
                                </Button>
                                <Line X1="0" X2="0" Y1="5" Y2="30" Stroke="DeepSkyBlue" StrokeThickness="1.5"
                                      Margin="5,0,5,0" />
                                <Button HorizontalAlignment="Left" VerticalAlignment="Center"
                                        ToolTip="Settings" BorderThickness="0" Margin="3,0,5,0"
                                        Command="{Binding OpenDialogViewCommand}" Style="{StaticResource ButtonStyle1}"
                                        CommandParameter="{x:Type views:SettingsWindow}" FocusVisualStyle="{x:Null}">
                                    <Image Source="../Assets/Icons/options.png" Width="27" Height="27"
                                           Stretch="Fill" />
                                </Button>
                            </DockPanel>
                        </StackPanel>
                        <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                            <Button VerticalAlignment="Center" ToolTip="Remove all" BorderThickness="0"
                                    Margin="0,0,4,0" Style="{StaticResource ButtonStyle1}"
                                    Command="{Binding Source={StaticResource MainViewModel}, Path=OpenDialogViewCommand}"
                                    CommandParameter="{x:Type views:RemoveAllDialogWindow}" FocusVisualStyle="{x:Null}">
                                <Image Source="../Assets/Icons/erase.png" Width="22px" Height="22px"
                                       HorizontalAlignment="Right" />
                            </Button>
                        </StackPanel>
                    </DockPanel>

                    <Grid Grid.Row="1" Margin="0,3,0,3" Name="Preview2DGrid"
                          Style="{StaticResource Preview2DGridStyle}"
                          Background="Transparent">
                        <Grid.Resources>
                            <preview2Dvc:SectionLinesToPathDataConverter x:Key="SectionLinesToPathDataConverter" />
                        </Grid.Resources>
                        <ItemsControl Name="Preview2DSections"
                                      ItemsSource="{Binding Source={StaticResource Shaft}, Path=Sections}"
                                      Background="Transparent">
                            <ItemsControl.Style>
                                <Style TargetType="ItemsControl">
                                    <Style.Triggers>
                                        <DataTrigger
                                            Binding="{Binding RelativeSource={RelativeSource AncestorType=Grid}, Path=Visibility}"
                                            Value="Collapsed">
                                            <Setter Property="IsEnabled" Value="False" />
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.Style>
                            <ItemsControl.Template>
                                <ControlTemplate>
                                    <Border BorderBrush="DeepSkyBlue" BorderThickness="1" x:Name="ItemsControlBorder">
                                        <ItemsPresenter />
                                    </Border>
                                </ControlTemplate>
                            </ItemsControl.Template>
                            <ItemsControl.Resources>
                                <Storyboard x:Key="OnMouseEnter" x:Shared="False"
                                            FillBehavior="HoldEnd">
                                    <ColorAnimation To="#65bde5" Duration="0:0:0.1"
                                                    Storyboard.Target="{Binding RelativeSource={RelativeSource AncestorType=Path}}"
                                                    Storyboard.TargetProperty="(Path.Fill).(SolidColorBrush.Color)" />
                                </Storyboard>
                                <Storyboard x:Key="OnMouseLeave" x:Shared="False">
                                    <ColorAnimation To="#a0a0a0" Duration="0:0:0.1"
                                                    Storyboard.Target="{Binding RelativeSource={RelativeSource AncestorType=Path}}"
                                                    Storyboard.TargetProperty="(Path.Fill).(SolidColorBrush.Color)" />
                                </Storyboard>
                                <Storyboard x:Key="OnSelectedMouseLeave" x:Shared="False" FillBehavior="HoldEnd">
                                    <ColorAnimation To="#25a1da" Duration="0:0:0.1"
                                                    Storyboard.Target="{Binding RelativeSource={RelativeSource AncestorType=Path}}"
                                                    Storyboard.TargetProperty="(Path.Fill).(SolidColorBrush.Color)" />
                                </Storyboard>
                                <Storyboard x:Key="OnMouseLeftButtonDown" x:Shared="False"
                                            Target="{Binding RelativeSource={RelativeSource AncestorType=Path}}"
                                            TargetProperty="(Path.Fill).(SolidColorBrush.Color)" FillBehavior="HoldEnd">
                                    <ColorAnimation To="#25a1da" Duration="0:0:0.1" />
                                </Storyboard>

                                <i:EventTrigger x:Key="MouseEnterTrigger" EventName="MouseEnter" x:Shared="False">
                                    <i:InvokeCommandAction
                                        Command="{Binding Source={StaticResource MainViewModel}, 
                                    Path=SetSectionUnderMouseCommand}"
                                        CommandParameter="{Binding}" />
                                </i:EventTrigger>
                                <i:EventTrigger x:Key="MouseLeaveTrigger" EventName="MouseLeave" x:Shared="False">
                                    <i:InvokeCommandAction
                                        Command="{Binding Source={StaticResource MainViewModel}, 
                                    Path=SetSectionUnderMouseCommand}"
                                        CommandParameter="{x:Null}" />
                                </i:EventTrigger>
                                <i:EventTrigger x:Key="MouseLeftButtonDownTrigger" EventName="MouseLeftButtonDown"
                                                x:Shared="False">
                                    <i:InvokeCommandAction
                                        Command="{Binding Source={StaticResource MainViewModel}, Path=SectionClickCommand}"
                                        CommandParameter="{Binding}" />
                                    <ie:ChangePropertyAction
                                        TargetObject="{Binding RelativeSource={RelativeSource TemplatedParent}}"
                                        PropertyName="Tag" Value="Selected" />
                                </i:EventTrigger>

                                <ContextMenu x:Key="PathContextMenu" FontSize="11">
                                    <ContextMenu.ItemsSource>
                                        <x:Array Type="sys:String">
                                            <sys:String>Edit</sys:String>
                                            <sys:String>Remove</sys:String>
                                        </x:Array>
                                    </ContextMenu.ItemsSource>
                                    <ContextMenu.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Background="White" />
                                        </ItemsPanelTemplate>
                                    </ContextMenu.ItemsPanel>
                                    <ContextMenu.ItemContainerStyle>
                                        <Style TargetType="MenuItem">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding}" Value="Edit">
                                                    <Setter Property="Command"
                                                            Value="{Binding Source={StaticResource MainViewModel}, 
                                        Path=OpenDialogViewCommand}" />
                                                    <Setter Property="CommandParameter"
                                                            Value="{Binding Source={StaticResource MainViewModel}, Path=SelectedSection,
                                                    Converter={StaticResource ShaftItemToParametersWindowTypeConverter}}" />
                                                </DataTrigger>
                                                <DataTrigger
                                                    Binding="{Binding}"
                                                    Value="Remove">
                                                    <Setter Property="Command"
                                                            Value="{Binding Source={StaticResource MainViewModel}, 
                                        Path=OpenDialogViewCommand}" />
                                                    <Setter Property="CommandParameter"
                                                            Value="{Binding Source={StaticResource MainViewModel}, Path=SelectedSection,
                                                    Converter={StaticResource ShaftItemToRemoveItemDialogWindowTypeConverter}}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ContextMenu.ItemContainerStyle>
                                    <ContextMenu.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="-33,0,-80,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="0.2*" />
                                                    <ColumnDefinition Width="0.8*" />
                                                </Grid.ColumnDefinitions>
                                                <Image Grid.Column="0"
                                                       VerticalAlignment="Center"
                                                       Height="14px" Width="14px">
                                                    <Image.Style>
                                                        <Style TargetType="Image">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding}"
                                                                             Value="Edit">
                                                                    <Setter Property="Source"
                                                                            Value="../Assets/Icons/openDialog.png" />
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding}"
                                                                             Value="Remove">
                                                                    <Setter Property="Source"
                                                                            Value="../Assets/Icons/deleteItem.png" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Image.Style>
                                                </Image>
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding}"
                                                           VerticalAlignment="Center" Margin="2,0,8,0" />
                                            </Grid>
                                        </DataTemplate>
                                    </ContextMenu.ItemTemplate>
                                </ContextMenu>
                                <Style TargetType="Path">
                                    <Setter Property="ContextMenu" Value="{StaticResource PathContextMenu}" />
                                </Style>

                            </ItemsControl.Resources>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <customUiElements:CenteringCanvas x:Name="CanvasPanel" IsItemsHost="True"
                                                                      HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center"
                                                                      ItemsControl="{x:Reference Name=Preview2DSections}"
                                                                      AxisLine="{x:Reference Name=AxisLine}">
                                        <customUiElements:CenteringCanvas.Style>
                                            <Style TargetType="customUiElements:CenteringCanvas">
                                                <Style.Triggers>
                                                    <DataTrigger
                                                        Binding="{Binding RelativeSource={RelativeSource AncestorType=Grid}, Path=Visibility}"
                                                        Value="Collapsed">
                                                        <Setter Property="IsEnabled" Value="False" />
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </customUiElements:CenteringCanvas.Style>
                                    </customUiElements:CenteringCanvas>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <i:Interaction.Behaviors>
                                <behaviors:SectionsItemsControlRefreshBehavior />
                            </i:Interaction.Behaviors>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Path>
                                        <Path.LayoutTransform>
                                            <ScaleTransform />
                                        </Path.LayoutTransform>
                                        <Path.Fill>
                                            <SolidColorBrush Color="#a0a0a0" />
                                        </Path.Fill>
                                        <Path.Data>
                                            <MultiBinding Converter="{StaticResource SectionLinesToPathDataConverter}">
                                                <Binding Path="." />
                                                <Binding ElementName="Preview2DSections" />
                                            </MultiBinding>
                                        </Path.Data>
                                        <Path.InputBindings>
                                            <MouseBinding Gesture="LeftDoubleClick"
                                                          Command="{Binding Source={StaticResource MainViewModel}, 
                                        Path=OpenDialogViewCommand}"
                                                          CommandParameter="{Binding 
                                                    Converter={StaticResource ShaftItemToParametersWindowTypeConverter}}" />
                                        </Path.InputBindings>
                                        <i:Interaction.Behaviors>
                                            <behaviors:SecitonPathBehavior
                                                InstalledSectionsTreeView="{x:Reference Name=InstalledSectionsTreeView}"
                                                InstalledPathsItemsControl="{x:Reference Name=Preview2DSections}"
                                                SectionsCombobox="{x:Reference Name=SectionsComboBox}" />
                                        </i:Interaction.Behaviors>
                                        <i:Interaction.Triggers>
                                            <StaticResource ResourceKey="MouseEnterTrigger" />
                                            <StaticResource ResourceKey="MouseLeaveTrigger" />
                                            <StaticResource ResourceKey="MouseLeftButtonDownTrigger" />
                                            <i:EventTrigger EventName="MouseRightButtonDown">
                                                <i:InvokeCommandAction
                                                    Command="{Binding Source={StaticResource MainViewModel}, Path=SetSelectedSectionCommand}"
                                                    CommandParameter="{Binding}" />
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                        <Path.Style>
                                            <Style TargetType="Path" BasedOn="{StaticResource {x:Type Path}}">
                                                <Setter Property="Stroke" Value="DeepSkyBlue" />
                                                <Setter Property="StrokeThickness" Value="1" />
                                                <Setter Property="HorizontalAlignment" Value="Center" />
                                                <Setter Property="VerticalAlignment" Value="Center" />
                                            </Style>
                                        </Path.Style>
                                    </Path>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- <ItemsControl Name="Preview2DSectionFeatures" ItemsSource="{Binding Source={StaticResource Shaft}, Path=Sections}" Background="Transparent">
                        <i:Interaction.Behaviors>
                            <behaviors:ItemsControlItemsSourceUpdatedRefreshBehavior />
                        </i:Interaction.Behaviors>
                        <ItemsControl.Template>
                            <ControlTemplate>
                                <Border BorderBrush="DeepSkyBlue" BorderThickness="1" x:Name="ItemsControlBorder">
                                    <ItemsPresenter />
                                </Border>
                            </ControlTemplate>
                        </ItemsControl.Template>
                    </ItemsControl>-->

                        <Canvas HorizontalAlignment="Center" VerticalAlignment="Center"
                                Width="0" Height="0" RenderTransform="1 0 0 -1 0 0" x:Name="AxisLineCanvas">
                            <Line x:Name="AxisLine"
                                  Stroke="Red"
                                  StrokeDashArray="6 2.5" IsHitTestVisible="False" />
                        </Canvas>

                    </Grid>



                    
                        <!--Grid.Row is assigned in the style`s trigger-->
                        <TreeView Name="InstalledSectionsTreeView" FontSize="11">
                            <TreeView.Style>
                            <Style TargetType="TreeView" BasedOn="{StaticResource InstalledSectionsPanelStyle}">
                                    <Style.Triggers>
                                        <DataTrigger
                                        Binding="{Binding Source={StaticResource MainViewModel}, Path=ComboboxSelectedItem}"
                                        Value="Sections">
                                            <Setter Property="ItemsSource"
                                                Value="{Binding Source={StaticResource Shaft}, Path=Sections}" />
                                        </DataTrigger>
                                        <DataTrigger
                                        Binding="{Binding Source={StaticResource MainViewModel}, Path=ComboboxSelectedItem}"
                                        Value="Bore on the left">
                                            <Setter Property="ItemsSource"
                                                Value="{Binding Source={StaticResource Shaft}, Path=BoreOnTheLeft}" />
                                        </DataTrigger>
                                        <DataTrigger
                                        Binding="{Binding Source={StaticResource MainViewModel}, Path=ComboboxSelectedItem}"
                                        Value="Bore on the right">
                                            <Setter Property="ItemsSource"
                                                Value="{Binding Source={StaticResource Shaft}, Path=BoreOnTheRight}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TreeView.Style>
                            <TreeView.Resources>
                                <i:EventTrigger EventName="MouseLeftButtonDown" x:Key="SetSelectedSectionOnLeftClick"
                                            x:Shared="False">
                                    <i:InvokeCommandAction
                                    Command="{Binding Source={StaticResource MainViewModel}, Path=SetSelectedSectionCommand}"
                                    CommandParameter="{Binding}" />
                                </i:EventTrigger>
                                <i:EventTrigger EventName="MouseEnter" x:Key="SetSectionUnderMouseOnMouseEnter"
                                            x:Shared="False">
                                    <i:InvokeCommandAction
                                    Command="{Binding Source={StaticResource MainViewModel}, Path=SetSectionUnderMouseCommand}"
                                    CommandParameter="{Binding}" />
                                </i:EventTrigger>
                                <i:EventTrigger EventName="MouseLeave" x:Key="SetNullSectionOnMouseLeave" x:Shared="False">
                                    <i:InvokeCommandAction
                                    Command="{Binding Source={StaticResource MainViewModel}, Path=SetSectionUnderMouseCommand}"
                                    CommandParameter="{x:Null}" />
                                </i:EventTrigger>
                                <ItemContainerTemplate x:Key="TooltipMessageItemContainerTemplate"
                                                   DataType="{x:Type models:ShaftSectionFeatureError}" x:Shared="False">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="!" FontSize="22" FontWeight="Bold" Foreground="#FF0002"
                                               VerticalAlignment="Center" />
                                        <TextBlock Margin="3,0,0,0"
                                               Foreground="Black" VerticalAlignment="Center"
                                               Text="{Binding ErrorMessage}" />
                                    </StackPanel>
                                </ItemContainerTemplate>
                                <StackPanel Margin="0,1,0,0" x:Key="CollisionErrorMessage" x:Shared="False">
                                    <StackPanel.Style>
                                        <Style TargetType="StackPanel">
                                            <Style.Triggers>
                                                <DataTrigger
                                                Binding="{Binding BoreDiameterCollisionError, Converter={StaticResource IsNotNullConverter}}"
                                                Value="False">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="!" FontSize="22" FontWeight="Bold" Foreground="#FF0002"
                                               VerticalAlignment="Center" />
                                        <TextBlock Margin="3,0,0,0"
                                               Foreground="Black" VerticalAlignment="Center"
                                               Text="Check a diameter for a collision" />
                                    </StackPanel>
                                    <TextBlock Margin="0,1,0,0" VerticalAlignment="Center" Foreground="Black"
                                           Text="{Binding BoreDiameterCollisionError.MaxDiameter, 
                                StringFormat='Max. possible diameter is {0:0.###}'}" />
                                </StackPanel>
                            </TreeView.Resources>
                            <TreeView.Template>
                                <ControlTemplate>
                                    <Border BorderBrush="DeepSkyBlue" BorderThickness="1">
                                    <ScrollViewer CanContentScroll="False">
                                        <ItemsPresenter/>
                                    </ScrollViewer>
                                        </Border>
                                </ControlTemplate>
                            </TreeView.Template>
                            <TreeView.ItemContainerStyle>
                                <Style TargetType="TreeViewItem" BasedOn="{StaticResource TreeViewItemStyle1}">
                                    <Style.Triggers>
                                        <DataTrigger
                                        Binding="{Binding Source={StaticResource MainViewModel}, Path=AllChildrenExpanded}"
                                        Value="True">
                                            <Setter Property="IsExpanded" Value="True" />
                                        </DataTrigger>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Value="True">
                                                    <Condition.Binding>
                                                        <MultiBinding Converter="{StaticResource SectionEqualityComparer}">
                                                            <Binding Source="{StaticResource MainViewModel}"
                                                                 Path="SectionUnderMouse" />
                                                            <Binding Path="." />
                                                        </MultiBinding>
                                                    </Condition.Binding>
                                                </Condition>
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Background" Value="#e5f3ff" />
                                        </MultiDataTrigger>
                                        <DataTrigger Value="True">
                                            <DataTrigger.Binding>
                                                <MultiBinding Converter="{StaticResource SectionEqualityComparer}">
                                                    <Binding Source="{StaticResource MainViewModel}"
                                                         Path="SelectedSection" />
                                                    <Binding Path="." />
                                                </MultiBinding>
                                            </DataTrigger.Binding>
                                            <Setter Property="IsSelected" Value="True" />
                                        </DataTrigger>
                                        <DataTrigger Value="False">
                                            <DataTrigger.Binding>
                                                <MultiBinding Converter="{StaticResource SectionEqualityComparer}">
                                                    <Binding Source="{StaticResource MainViewModel}"
                                                         Path="SelectedSection" />
                                                    <Binding Path="." />
                                                </MultiBinding>
                                            </DataTrigger.Binding>
                                            <Setter Property="IsSelected" Value="False" />
                                        </DataTrigger>
                                        <EventTrigger RoutedEvent="Selected">
                                            <BeginStoryboard>
                                                <Storyboard
                                                TargetProperty="(TreeViewItem.Background).(SolidColorBrush.Color)"
                                                Duration="0:0:0.1" FillBehavior="HoldEnd">
                                                    <ColorAnimation To="#cde8ff" />
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TreeView.ItemContainerStyle>
                            <TreeView.ItemTemplate>
                                <HierarchicalDataTemplate ItemsSource="{Binding SubFeatures}">
                                    <Grid ap:ControlIndicator.IsSectionGrid="True">
                                        <Grid.Style>
                                            <Style TargetType="Grid">
                                                <Setter Property="Background" Value="Transparent" />
                                                <Setter Property="ToolTipService.InitialShowDelay" Value="2000" />
                                                <Setter Property="ToolTipService.BetweenShowDelay" Value="0" />
                                                <Setter Property="ToolTipService.ShowDuration" Value="6000" />
                                                <Setter Property="Width">
                                                    <Setter.Value>
                                                        <MultiBinding Converter="{StaticResource SumConverter}">
                                                            <Binding
                                                            RelativeSource="{RelativeSource FindAncestor, AncestorType=ScrollContentPresenter, 
                                            AncestorLevel=1}"
                                                            Path="ActualWidth" />
                                                            <Binding
                                                            RelativeSource="{RelativeSource FindAncestor, AncestorType=TreeViewItem, AncestorLevel=1}"
                                                            Converter="{StaticResource ParentCountConverter}" />
                                                        </MultiBinding>
                                                    </Setter.Value>
                                                </Setter>

                                                <Style.Triggers>
                                                    <MultiDataTrigger>
                                                        <MultiDataTrigger.Conditions>
                                                            <Condition
                                                            Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                            Value="{x:Type sections:CylinderSection}" />
                                                            <Condition
                                                            Binding="{Binding BoreDiameterCollisionError, Converter={StaticResource IsNotNullConverter}}"
                                                            Value="True" />
                                                        </MultiDataTrigger.Conditions>
                                                        <Setter Property="Background" Value="#fdadad" />
                                                        <Setter Property="ToolTipService.InitialShowDelay" Value="400" />
                                                    </MultiDataTrigger>
                                                    <MultiDataTrigger>
                                                        <MultiDataTrigger.Conditions>
                                                            <Condition
                                                            Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                            Value="{x:Type sections:ConeSection}" />
                                                            <Condition
                                                            Binding="{Binding BoreDiameterCollisionError, Converter={StaticResource IsNotNullConverter}}"
                                                            Value="True" />
                                                        </MultiDataTrigger.Conditions>
                                                        <Setter Property="Background" Value="#fdadad" />
                                                        <Setter Property="ToolTipService.InitialShowDelay" Value="400" />
                                                    </MultiDataTrigger>

                                                    <DataTrigger
                                                    Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                    Value="{x:Type sections:CylinderSection}">
                                                        <Setter Property="ToolTip">
                                                            <Setter.Value>
                                                                <StackPanel>
                                                                    <TextBlock Text="Cylinder" />
                                                                    <TextBlock Margin="0,1,0,0"
                                                                           Text="{Binding Diameter, StringFormat='D = {0:F} mm (Main Diameter)'}" />
                                                                    <TextBlock Margin="0,1,0,0"
                                                                           Text="{Binding Length, StringFormat='L = {0:F} mm (Section Length)'}" />
                                                                    <ContentControl
                                                                    Content="{StaticResource CollisionErrorMessage}" />
                                                                </StackPanel>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                    Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                    Value="{x:Type sections:ConeSection}">
                                                        <Setter Property="ToolTip">
                                                            <Setter.Value>
                                                                <StackPanel>
                                                                    <TextBlock Text="Cone" />
                                                                    <TextBlock Margin="0,1,0,0">
                                                                    <Run Text="D" />
                                                                    <Run Text="1" BaselineAlignment="Subscript"
                                                                         FontSize="9" />
                                                                    <Run
                                                                        Text="{Binding Diameter1, StringFormat=' = {0:F} mm (First Diameter)'}" />
                                                                    </TextBlock>
                                                                    <TextBlock Margin="0,1,0,0">
                                                                    <Run Text="D" />
                                                                    <Run Text="2" BaselineAlignment="Subscript"
                                                                         FontSize="9" />
                                                                    <Run
                                                                        Text="{Binding Diameter2, StringFormat=' = {0:F} mm (Second Diameter)'}" />
                                                                    </TextBlock>
                                                                    <TextBlock
                                                                    Text="{Binding Length, StringFormat='L = {0:F} mm (Section Length)'}" />
                                                                    <ContentControl
                                                                    Content="{StaticResource CollisionErrorMessage}" />
                                                                </StackPanel>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger
                                                    Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                    Value="{x:Type sections:PolygonSection}">
                                                        <Setter Property="ToolTip">
                                                            <Setter.Value>
                                                                <StackPanel>
                                                                    <TextBlock Text="Polygon" />
                                                                    <TextBlock Margin="0,1,0,0"
                                                                           Text="{Binding NumberOfEdges, 
                                                                StringFormat='N = {0} ul (Number of Edges)'}" />
                                                                    <TextBlock Margin="0,1,0,0">
                                                                    <Run Text="D" />
                                                                    <Run Text="in" BaselineAlignment="Subscript"
                                                                         FontSize="9" />
                                                                    <Run
                                                                        Text="{Binding InscribedCircleDiameter, 
                                                                    StringFormat=' = {0:F} mm (Diameter Inscribed)'}" />
                                                                    </TextBlock>
                                                                    <TextBlock Margin="0,1,0,0"
                                                                           Text="{Binding Length, 
                                                                StringFormat='L = {0:F} mm (Section Length)'}" />
                                                                    <ContentControl
                                                                    Content="{StaticResource CollisionErrorMessage}" />
                                                                </StackPanel>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Grid.Style>
                                        <i:Interaction.Triggers>
                                            <StaticResource ResourceKey="SetSelectedSectionOnLeftClick" />
                                            <StaticResource ResourceKey="SetSectionUnderMouseOnMouseEnter" />
                                            <StaticResource ResourceKey="SetNullSectionOnMouseLeave" />
                                        </i:Interaction.Triggers>
                                        <Grid.InputBindings>
                                            <MouseBinding Gesture="LeftDoubleClick"
                                                      Command="{Binding Source={StaticResource MainViewModel}, 
                                        Path=OpenDialogViewCommand}"
                                                      CommandParameter="{Binding 
                                                    Converter={StaticResource ShaftItemToParametersWindowTypeConverter}}" />
                                        </Grid.InputBindings>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="0.39*" />
                                            <ColumnDefinition Width="0.57*" />
                                            <ColumnDefinition Width="0.04*" />
                                        </Grid.ColumnDefinitions>
                                        <DockPanel Grid.Column="0">
                                            <Border BorderThickness="1" Background="WhiteSmoke" Width="30"
                                                Height="30"
                                                BorderBrush="DeepSkyBlue" Margin="0,0.3,0,0.3">
                                                <Image Width="26"
                                                   Height="26">
                                                    <Image.Style>
                                                        <Style TargetType="Image">
                                                            <Style.Triggers>
                                                                <MultiDataTrigger>
                                                                    <MultiDataTrigger.Conditions>
                                                                        <Condition
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type sections:CylinderSection}" />
                                                                        <Condition Binding="{Binding IsBore}" Value="False" />
                                                                    </MultiDataTrigger.Conditions>
                                                                    <Setter Property="Source"
                                                                        Value="../Assets/Icons/cylinderIcon.png" />
                                                                </MultiDataTrigger>
                                                                <MultiDataTrigger>
                                                                    <MultiDataTrigger.Conditions>
                                                                        <Condition
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type sections:CylinderSection}" />
                                                                        <Condition Binding="{Binding IsBore}" Value="True" />
                                                                        <Condition
                                                                        Binding="{Binding Source={StaticResource MainViewModel}, Path=ComboboxSelectedItem}"
                                                                        Value="Bore on the left" />
                                                                    </MultiDataTrigger.Conditions>
                                                                    <Setter Property="Source"
                                                                        Value="../Assets/Icons/insertCylinderBoreLeft.png" />
                                                                </MultiDataTrigger>
                                                                <MultiDataTrigger>
                                                                    <MultiDataTrigger.Conditions>
                                                                        <Condition
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type sections:CylinderSection}" />
                                                                        <Condition Binding="{Binding IsBore}" Value="True" />
                                                                        <Condition
                                                                        Binding="{Binding Source={StaticResource MainViewModel}, Path=ComboboxSelectedItem}"
                                                                        Value="Bore on the right" />
                                                                    </MultiDataTrigger.Conditions>
                                                                    <Setter Property="Source"
                                                                        Value="../Assets/Icons/insertCylinderBoreRight.png" />
                                                                </MultiDataTrigger>

                                                                <MultiDataTrigger>
                                                                    <MultiDataTrigger.Conditions>
                                                                        <Condition
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type sections:ConeSection}" />
                                                                        <Condition Binding="{Binding IsBore}" Value="False" />
                                                                    </MultiDataTrigger.Conditions>
                                                                    <Setter Property="Source"
                                                                        Value="../Assets/Icons/coneIcon.png" />
                                                                </MultiDataTrigger>
                                                                <MultiDataTrigger>
                                                                    <MultiDataTrigger.Conditions>
                                                                        <Condition
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type sections:ConeSection}" />
                                                                        <Condition Binding="{Binding IsBore}" Value="True" />
                                                                        <Condition
                                                                        Binding="{Binding Source={StaticResource MainViewModel}, Path=ComboboxSelectedItem}"
                                                                        Value="Bore on the left" />
                                                                    </MultiDataTrigger.Conditions>
                                                                    <Setter Property="Source"
                                                                        Value="../Assets/Icons/insertConicalBoreLeft.png" />
                                                                </MultiDataTrigger>
                                                                <MultiDataTrigger>
                                                                    <MultiDataTrigger.Conditions>
                                                                        <Condition
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type sections:ConeSection}" />
                                                                        <Condition Binding="{Binding IsBore}" Value="True" />
                                                                        <Condition
                                                                        Binding="{Binding Source={StaticResource MainViewModel}, Path=ComboboxSelectedItem}"
                                                                        Value="Bore on the right" />
                                                                    </MultiDataTrigger.Conditions>
                                                                    <Setter Property="Source"
                                                                        Value="../Assets/Icons/insertConicalBoreRight.png" />
                                                                </MultiDataTrigger>

                                                                <DataTrigger
                                                                Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                Value="{x:Type sections:PolygonSection}">
                                                                    <Setter Property="Source"
                                                                        Value="../Assets/Icons/poligoneIconS.png" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Image.Style>
                                                </Image>
                                            </Border>
                                            <TextBlock Margin="2,0,0,0" VerticalAlignment="Center"
                                                   Text="{Binding DisplayName}" />
                                        </DockPanel>
                                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                                            <Border Width="48" Height="30"
                                                BorderBrush="DeepSkyBlue" Name="FirstEdgeFeatureBorder"
                                                Tag="SectionTreeViewItemButtonBorder">
                                                <i:Interaction.Triggers>
                                                    <StaticResource ResourceKey="SetSelectedSectionOnLeftClick" />
                                                    <StaticResource ResourceKey="SetSectionUnderMouseOnMouseEnter" />
                                                    <StaticResource ResourceKey="SetNullSectionOnMouseLeave" />
                                                </i:Interaction.Triggers>
                                                <i:Interaction.Behaviors>
                                                    <behaviors:ShowHideSectionFeatureButtons />
                                                </i:Interaction.Behaviors>
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="BorderThickness" Value="1" />
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding FirstEdgeFeatureHasErrors}"
                                                                     Value="True">
                                                                <Setter Property="ToolTipService.InitialShowDelay"
                                                                    Value="250" />
                                                                <Setter Property="ToolTipService.ShowDuration"
                                                                    Value="10000" />
                                                                <Setter Property="ToolTip">
                                                                    <Setter.Value>
                                                                        <ItemsControl
                                                                        ItemsSource="{Binding Path=FirstEdgeFeature.FeatureErrors}"
                                                                        ItemTemplate="{StaticResource TooltipMessageItemContainerTemplate}" />
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding AvailableFirstEdgeFeatures[0]}"
                                                                     Value="{StaticResource EdgeFeatureNotAvailable}">
                                                                <Setter Property="ToolTip"
                                                                    Value="Edge features are unavailable" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding FirstEdgeFeatureHasErrors}"
                                                                     Value="False">
                                                                <Setter Property="ToolTipService.InitialShowDelay"
                                                                    Value="1500" />
                                                                <Setter Property="ToolTipService.BetweenShowDelay"
                                                                    Value="0" />
                                                                <Setter Property="ToolTip" Value="First edge features" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <Border.InputBindings>
                                                    <MouseBinding MouseAction="LeftClick"
                                                              Command="{Binding Source={StaticResource MainViewModel}, Path=SetActiveEdgeFeaturePositionCommand}"
                                                              CommandParameter="{StaticResource FirstEdgePosition}" />
                                                </Border.InputBindings>
                                                <StackPanel Orientation="Horizontal">
                                                    <StackPanel
                                                    ap:ControlIndicator.IsSectionFeatureStackPanel="True">
                                                        <i:Interaction.Behaviors>
                                                            <behaviors:SectionHasErrorStackPanelBehavior />
                                                        </i:Interaction.Behaviors>
                                                        <StackPanel.Style>
                                                            <Style TargetType="StackPanel">
                                                                <Style.Triggers>
                                                                    <DataTrigger
                                                                    Binding="{Binding FirstEdgeFeatureHasErrors}"
                                                                    Value="True">
                                                                        <Setter Property="Background" Value="#fdadad" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </StackPanel.Style>
                                                        <i:Interaction.Triggers>
                                                            <i:EventTrigger EventName="MouseLeftButtonDown">
                                                                <i:InvokeCommandAction
                                                                Command="{Binding Source={StaticResource MainViewModel}, Path=SetActiveEdgeFeaturePositionCommand}"
                                                                CommandParameter="{StaticResource FirstEdgePosition}" />
                                                            </i:EventTrigger>
                                                        </i:Interaction.Triggers>
                                                        <Image x:Name="EdgeFeatureImage">
                                                            <i:Interaction.Triggers>
                                                                <i:EventTrigger EventName="MouseLeftButtonDown">
                                                                    <i:InvokeCommandAction
                                                                    Command="{Binding Source={StaticResource MainViewModel}, Path=SetSelectedSectionCommand}"
                                                                    CommandParameter="{Binding}" />
                                                                </i:EventTrigger>
                                                                <i:EventTrigger EventName="MouseLeftButtonDown">
                                                                    <i:InvokeCommandAction
                                                                    Command="{Binding Source={StaticResource MainViewModel}, Path=SetActiveEdgeFeaturePositionCommand}"
                                                                    CommandParameter="{StaticResource FirstEdgePosition}" />
                                                                </i:EventTrigger>
                                                                <i:EventTrigger EventName="MouseLeftButtonDown">
                                                                    <i:InvokeCommandAction
                                                                    Command="{Binding Source={StaticResource MainViewModel}, Path=OpenDialogViewCommand}"
                                                                    CommandParameter="{Binding FirstEdgeFeature, Converter={StaticResource SectionFeatureToWindowTypeConverter}}">
                                                                        <i:InvokeCommandAction.IsEnabled>
                                                                            <MultiBinding
                                                                            Converter="{StaticResource EdgeFeaturesAvailableConverter}">
                                                                                <Binding Path="FirstEdgeFeature" />
                                                                                <Binding
                                                                                Path="AvailableFirstEdgeFeatures[0]" />
                                                                            </MultiBinding>
                                                                        </i:InvokeCommandAction.IsEnabled>
                                                                    </i:InvokeCommandAction>
                                                                </i:EventTrigger>
                                                            </i:Interaction.Triggers>
                                                            <Image.Style>
                                                                <Style TargetType="Image">
                                                                    <Setter Property="Margin" Value="5,0,5,0" />
                                                                    <Setter Property="Width" Value="26" />
                                                                    <Setter Property="Height" Value="26" />
                                                                    <Setter Property="Source"
                                                                        Value="{Binding FirstEdgeFeature, 
                                                                Converter={StaticResource EdgeFeatureToImageConverter},
                                                                ConverterParameter={StaticResource FirstEdgePosition}}" />
                                                                    <Style.Triggers>
                                                                        <DataTrigger
                                                                        Binding="{Binding AvailableFirstEdgeFeatures[0]}"
                                                                        Value="{StaticResource EdgeFeatureNotAvailable}">
                                                                            <Setter Property="Source"
                                                                                Value="../Assets/Icons/unavailable.png" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Image.Style>
                                                        </Image>
                                                    </StackPanel>
                                                    <StackPanel Background="Transparent">
                                                        <i:Interaction.Triggers>
                                                            <i:EventTrigger EventName="MouseLeftButtonDown">
                                                                <i:InvokeCommandAction
                                                                Command="{Binding Source={StaticResource MainViewModel}, Path=SetActiveEdgeFeaturePositionCommand}"
                                                                CommandParameter="{StaticResource FirstEdgePosition}" />
                                                            </i:EventTrigger>
                                                        </i:Interaction.Triggers>
                                                        <ContentControl
                                                        Content="{StaticResource FirstEdgeContextMenuButton}" />
                                                    </StackPanel>
                                                </StackPanel>
                                            </Border>
                                            <Border BorderThickness="1" Width="48" Height="30"
                                                BorderBrush="DeepSkyBlue" Name="SectionsBorder"
                                                Tag="SectionTreeViewItemButtonBorder" Margin="3,0,0,0">
                                                <i:Interaction.Triggers>
                                                    <StaticResource ResourceKey="SetSelectedSectionOnLeftClick" />
                                                    <StaticResource ResourceKey="SetSectionUnderMouseOnMouseEnter" />
                                                    <StaticResource ResourceKey="SetNullSectionOnMouseLeave" />
                                                </i:Interaction.Triggers>
                                                <i:Interaction.Behaviors>
                                                    <behaviors:ShowHideSectionFeatureButtons />
                                                </i:Interaction.Behaviors>
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="ToolTipService.InitialShowDelay" Value="1500" />
                                                        <Setter Property="ToolTipService.BetweenShowDelay" Value="0" />
                                                        <Setter Property="ToolTip" Value="Sections" />
                                                    </Style>
                                                </Border.Style>
                                                <StackPanel Orientation="Horizontal"
                                                        ap:ControlIndicator.IsSectionFeatureStackPanel="True">
                                                    <Image x:Name="SectionImage">
                                                        <Image.Style>
                                                            <Style TargetType="Image">
                                                                <Setter Property="Margin" Value="5,0,5,0" />
                                                                <Setter Property="Width" Value="26" />
                                                                <Setter Property="Height" Value="26" />
                                                                <Style.Triggers>
                                                                    <DataTrigger
                                                                    Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                    Value="{x:Type sections:CylinderSection}">
                                                                        <Setter Property="Source"
                                                                            Value="../Assets/Icons/cylinderIcon.png" />
                                                                    </DataTrigger>
                                                                    <DataTrigger
                                                                    Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                    Value="{x:Type sections:ConeSection}">
                                                                        <Setter Property="Source"
                                                                            Value="../Assets/Icons/coneIcon.png" />
                                                                    </DataTrigger>
                                                                    <DataTrigger
                                                                    Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                    Value="{x:Type sections:PolygonSection}">
                                                                        <Setter Property="Source"
                                                                            Value="../Assets/Icons/poligoneIconS.png" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Image.Style>
                                                    </Image>
                                                    <ContentControl Content="{StaticResource SectionsContextMenuButton}" />
                                                </StackPanel>
                                            </Border>
                                            <Border BorderThickness="1" Width="48" Height="30"
                                                BorderBrush="DeepSkyBlue" Name="SecondEdgeFeatureBorder"
                                                Tag="SectionTreeViewItemButtonBorder"
                                                Margin="3,0,0,0">
                                                <i:Interaction.Triggers>
                                                    <StaticResource ResourceKey="SetSelectedSectionOnLeftClick" />
                                                    <StaticResource ResourceKey="SetSectionUnderMouseOnMouseEnter" />
                                                    <StaticResource ResourceKey="SetNullSectionOnMouseLeave" />
                                                </i:Interaction.Triggers>
                                                <i:Interaction.Behaviors>
                                                    <behaviors:ShowHideSectionFeatureButtons />
                                                </i:Interaction.Behaviors>
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="ToolTipService.InitialShowDelay" Value="1500" />
                                                        <Setter Property="ToolTipService.BetweenShowDelay" Value="0" />
                                                        <Setter Property="ToolTip" Value="Second edge features" />
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding SecondEdgeFeatureHasErrors}"
                                                                     Value="True">
                                                                <DataTrigger.Setters>
                                                                    <Setter Property="ToolTipService.InitialShowDelay"
                                                                        Value="250" />
                                                                    <Setter Property="ToolTipService.ShowDuration"
                                                                        Value="10000" />
                                                                    <Setter Property="ToolTip">
                                                                        <Setter.Value>
                                                                            <ItemsControl
                                                                            ItemsSource="{Binding Path=SecondEdgeFeature.FeatureErrors}"
                                                                            ItemTemplate="{StaticResource TooltipMessageItemContainerTemplate}" />
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                </DataTrigger.Setters>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding AvailableSecondEdgeFeatures[0]}"
                                                                     Value="{StaticResource EdgeFeatureNotAvailable}">
                                                                <Setter Property="ToolTip"
                                                                    Value="Edge features are unavailable" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <StackPanel Orientation="Horizontal">
                                                    <StackPanel
                                                    ap:ControlIndicator.IsSectionFeatureStackPanel="True">
                                                        <StackPanel.Style>
                                                            <Style TargetType="StackPanel">
                                                                <Style.Triggers>
                                                                    <DataTrigger
                                                                    Binding="{Binding SecondEdgeFeatureHasErrors}"
                                                                    Value="True">
                                                                        <Setter Property="Background" Value="#fdadad" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </StackPanel.Style>
                                                        <i:Interaction.Triggers>
                                                            <i:EventTrigger EventName="MouseLeftButtonDown">
                                                                <i:InvokeCommandAction
                                                                Command="{Binding Source={StaticResource MainViewModel}, Path=SetActiveEdgeFeaturePositionCommand}"
                                                                CommandParameter="{StaticResource SecondEdgePosition}" />
                                                            </i:EventTrigger>
                                                        </i:Interaction.Triggers>
                                                        <Image x:Name="SecondEdgeFeatureImage">
                                                            <i:Interaction.Triggers>
                                                                <i:EventTrigger EventName="MouseLeftButtonDown">
                                                                    <i:InvokeCommandAction
                                                                    Command="{Binding Source={StaticResource MainViewModel}, Path=SetSelectedSectionCommand}"
                                                                    CommandParameter="{Binding}" />
                                                                </i:EventTrigger>
                                                                <i:EventTrigger EventName="MouseLeftButtonDown">
                                                                    <i:InvokeCommandAction
                                                                    Command="{Binding Source={StaticResource MainViewModel}, Path=SetActiveEdgeFeaturePositionCommand}"
                                                                    CommandParameter="{StaticResource SecondEdgePosition}" />
                                                                </i:EventTrigger>
                                                                <i:EventTrigger EventName="MouseLeftButtonDown">
                                                                    <i:InvokeCommandAction
                                                                    Command="{Binding Source={StaticResource MainViewModel}, Path=OpenDialogViewCommand}"
                                                                    CommandParameter="{Binding SecondEdgeFeature, Converter={StaticResource SectionFeatureToWindowTypeConverter}}">
                                                                        <i:InvokeCommandAction.IsEnabled>
                                                                            <MultiBinding
                                                                            Converter="{StaticResource EdgeFeaturesAvailableConverter}">
                                                                                <Binding Path="SecondEdgeFeature" />
                                                                                <Binding
                                                                                Path="AvailableSecondEdgeFeatures[0]" />
                                                                            </MultiBinding>
                                                                        </i:InvokeCommandAction.IsEnabled>
                                                                    </i:InvokeCommandAction>
                                                                </i:EventTrigger>
                                                            </i:Interaction.Triggers>
                                                            <Image.Style>
                                                                <Style TargetType="Image">
                                                                    <Style.Resources>
                                                                    </Style.Resources>
                                                                    <Setter Property="Margin" Value="5,0,5,0" />
                                                                    <Setter Property="Width" Value="26" />
                                                                    <Setter Property="Height" Value="26" />
                                                                    <Setter Property="Source"
                                                                        Value="{Binding SecondEdgeFeature, 
                                                                Converter={StaticResource EdgeFeatureToImageConverter},
                                                                ConverterParameter={StaticResource SecondEdgePosition}}" />
                                                                    <Style.Triggers>
                                                                        <DataTrigger
                                                                        Binding="{Binding AvailableSecondEdgeFeatures[0]}"
                                                                        Value="{StaticResource EdgeFeatureNotAvailable}">
                                                                            <Setter Property="Source"
                                                                                Value="../Assets/Icons/unavailable.png" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Image.Style>
                                                        </Image>
                                                    </StackPanel>
                                                    <StackPanel>
                                                        <i:Interaction.Triggers>
                                                            <i:EventTrigger EventName="MouseLeftButtonDown">
                                                                <i:InvokeCommandAction
                                                                Command="{Binding Source={StaticResource MainViewModel}, Path=SetActiveEdgeFeaturePositionCommand}"
                                                                CommandParameter="{StaticResource SecondEdgePosition}" />
                                                            </i:EventTrigger>
                                                        </i:Interaction.Triggers>
                                                        <ContentControl
                                                        Content="{StaticResource SecondEdgeContextMenuButton}" />
                                                    </StackPanel>
                                                </StackPanel>
                                            </Border>
                                            <Border BorderThickness="1" Width="48" Height="30"
                                                BorderBrush="DeepSkyBlue" Name="SubFeatureBorder" Margin="3,0,0,0"
                                                Tag="SectionTreeViewItemButtonBorder">
                                                <i:Interaction.Triggers>
                                                    <StaticResource ResourceKey="SetSelectedSectionOnLeftClick" />
                                                    <StaticResource ResourceKey="SetSectionUnderMouseOnMouseEnter" />
                                                    <StaticResource ResourceKey="SetNullSectionOnMouseLeave" />
                                                </i:Interaction.Triggers>
                                                <i:Interaction.Behaviors>
                                                    <behaviors:ShowHideSectionFeatureButtons />
                                                </i:Interaction.Behaviors>
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="ToolTipService.InitialShowDelay" Value="1500" />
                                                        <Setter Property="ToolTipService.BetweenShowDelay" Value="0" />
                                                        <Setter Property="ToolTip" Value="Section subfeatures" />
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                            Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                            Value="{x:Type sections:ConeSection}">
                                                                <Setter Property="ToolTip"
                                                                    Value="Subfeatures aren't available for a cone section" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <StackPanel Orientation="Horizontal"
                                                        ap:ControlIndicator.IsSectionFeatureStackPanel="True">
                                                    <Image x:Name="SubFeatureImage">
                                                        <Image.Style>
                                                            <Style TargetType="Image">
                                                                <Setter Property="Margin" Value="5,0,5,0" />
                                                                <Setter Property="Width" Value="26" />
                                                                <Setter Property="Height" Value="26" />
                                                                <Setter Property="Source"
                                                                    Value="../Assets/Icons/subFeatureNone.png" />
                                                                <Style.Triggers>
                                                                    <DataTrigger
                                                                    Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                    Value="{x:Type sections:ConeSection}">
                                                                        <Setter Property="Source"
                                                                            Value="../Assets/Icons/unavailable.png" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Image.Style>
                                                    </Image>
                                                    <ContentControl>
                                                        <ContentControl.Style>
                                                            <Style TargetType="ContentControl">
                                                                <Setter Property="Content"
                                                                    Value="{StaticResource SubFeatureContextMenuButton}" />
                                                                <Style.Triggers>
                                                                    <DataTrigger
                                                                    Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                    Value="{x:Type sections:ConeSection}">
                                                                        <Setter Property="Content">
                                                                            <Setter.Value>
                                                                                <Button
                                                                                Style="{StaticResource OpenContextMenuButtonStyle}" />
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </ContentControl.Style>
                                                    </ContentControl>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2" HorizontalAlignment="Right">
                                            <i:Interaction.Behaviors>
                                                <behaviors:ShowHideUIElementBehavior AncestorGridLevel="1" />
                                            </i:Interaction.Behaviors>
                                            <ContentControl Content="{StaticResource OpenParametersDialogButton}" />
                                            <ContentControl Content="{StaticResource RemoveItemButton}" />
                                        </StackPanel>
                                    </Grid>
                                    <HierarchicalDataTemplate.ItemTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <i:Interaction.Behaviors>
                                                    <behaviors:RelaunchMouseEnterEventBehavior />
                                                </i:Interaction.Behaviors>
                                                <Grid.Style>
                                                    <Style TargetType="Grid">
                                                        <Setter Property="Background" Value="Transparent" />
                                                        <Setter Property="ToolTipService.InitialShowDelay" Value="2000" />
                                                        <Setter Property="ToolTipService.BetweenShowDelay" Value="0" />
                                                        <Setter Property="ToolTipService.ShowDuration" Value="6000" />
                                                        <Setter Property="Width">
                                                            <Setter.Value>
                                                                <MultiBinding Converter="{StaticResource SumConverter}">
                                                                    <Binding
                                                                    RelativeSource="{RelativeSource FindAncestor, AncestorType=ScrollContentPresenter, 
                                            AncestorLevel=1}"
                                                                    Path="ActualWidth" />
                                                                    <Binding
                                                                    RelativeSource="{RelativeSource FindAncestor, AncestorType=TreeViewItem, AncestorLevel=1}"
                                                                    Converter="{StaticResource ParentCountConverter}" />
                                                                </MultiBinding>
                                                            </Setter.Value>
                                                        </Setter>
                                                        <Style.Triggers>
                                                            <DataTrigger
                                                            Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                            Value="{x:Type subFeatures:ThroughHoleSubFeature}">
                                                                <Setter Property="ToolTip">
                                                                    <Setter.Value>
                                                                        <StackPanel>
                                                                            <TextBlock Text="Through hole" />
                                                                            <TextBlock Margin="0,1,0,0">
                                                                            <Run Text="D" />
                                                                            <Run Text="hole" FontSize="9"
                                                                                 BaselineAlignment="Subscript" />
                                                                            <Run
                                                                                Text="{Binding HoleDiameter, StringFormat=' = {0:F3} mm (Hole diameter)'}" />
                                                                            </TextBlock>
                                                                        </StackPanel>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </DataTrigger>
                                                            <DataTrigger
                                                            Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                            Value="{x:Type subFeatures:RetainingRingGrooveSubFeature}">
                                                                <Setter Property="ToolTip">
                                                                    <Setter.Value>
                                                                        <StackPanel>
                                                                            <TextBlock Text="Retaining ring" />
                                                                            <TextBlock Margin="0,1,0,0"
                                                                                   Text="{Binding Width, StringFormat='M = {0:F3} mm (Width)'}" />
                                                                            <TextBlock Margin="0,1,0,0"
                                                                                   Text="{Binding ActiveLength, StringFormat='LF = {0:F3} mm (Active length)'}" />
                                                                        </StackPanel>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </DataTrigger>
                                                            <DataTrigger
                                                            Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                            Value="{x:Type subFeatures:WrenchSubFeature}">
                                                                <Setter Property="ToolTip">
                                                                    <Setter.Value>
                                                                        <StackPanel>
                                                                            <TextBlock Text="Wrench" />
                                                                            <TextBlock Margin="0,1,0,0"
                                                                                   Text="{Binding WidthsAcrossFlats, StringFormat='W = {0:F3} mm (Width across flats)'}" />
                                                                        </StackPanel>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </DataTrigger>
                                                            <DataTrigger
                                                            Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                            Value="{x:Type subFeatures:KeywayGrooveSubFeature}">
                                                                <Setter Property="ToolTip">
                                                                    <Setter.Value>
                                                                        <StackPanel>
                                                                            <TextBlock>
                                                                            <Run Text="Keyway " />
                                                                            <Run
                                                                                Text="{Binding Width, StringFormat={}{0:0.###} x }" />
                                                                            <Run
                                                                                Text="{Binding Depth, StringFormat={}{0:0.###} x }" />
                                                                            <Run
                                                                                Text="{Binding KeywayLength, StringFormat={}{0:0.###} }" />
                                                                            <Run Text="{Binding Keyway.Name}" />
                                                                            </TextBlock>
                                                                        </StackPanel>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </DataTrigger>
                                                            <DataTrigger
                                                            Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                            Value="{x:Type subFeatures:ReliefDSISubFeature}">
                                                                <Setter Property="ToolTip">
                                                                    <Setter.Value>
                                                                        <StackPanel>
                                                                            <TextBlock Text="Relief - D (SI Units)" />
                                                                            <TextBlock
                                                                            Text="{Binding Width, StringFormat='b = {0:F3} mm (Width)'}" />
                                                                            <TextBlock
                                                                            Text="{Binding ReliefDepth, StringFormat='h = {0:F3} mm (Relief depth)'}" />
                                                                        </StackPanel>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </DataTrigger>
                                                            <DataTrigger
                                                            Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                            Value="{x:Type subFeatures:GrooveASubFeature}">
                                                                <Setter Property="ToolTip">
                                                                    <Setter.Value>
                                                                        <StackPanel>
                                                                            <TextBlock Text="Groove - A" />
                                                                            <TextBlock
                                                                            Text="{Binding Depth, StringFormat='H = {0:F3} mm (Depth)'}" />
                                                                            <TextBlock
                                                                            Text="{Binding Radius, StringFormat='R = {0:F3} mm (Radius)'}" />
                                                                        </StackPanel>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </DataTrigger>
                                                            <DataTrigger
                                                            Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                            Value="{x:Type subFeatures:GrooveBSubFeature}">
                                                                <Setter Property="ToolTip">
                                                                    <Setter.Value>
                                                                        <StackPanel>
                                                                            <TextBlock Text="Groove - B" />
                                                                            <TextBlock
                                                                            Text="{Binding Depth, StringFormat='H = {0:F3} mm (Depth)'}" />
                                                                            <TextBlock
                                                                            Text="{Binding Radius, StringFormat='R = {0:F3} mm (Radius)'}" />
                                                                        </StackPanel>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </DataTrigger>
                                                            <DataTrigger
                                                            Binding="{Binding Path=FeatureErrors[0], Converter={StaticResource IsNotNullConverter}}"
                                                            Value="True">
                                                                <DataTrigger.Setters>
                                                                    <Setter Property="Background" Value="#fdadad" />
                                                                    <Setter Property="ToolTipService.InitialShowDelay"
                                                                        Value="600" />
                                                                    <Setter Property="ToolTip">
                                                                        <Setter.Value>
                                                                            <ItemsControl
                                                                            ItemsSource="{Binding FeatureErrors}"
                                                                            ItemTemplate="{StaticResource TooltipMessageItemContainerTemplate}" />
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                </DataTrigger.Setters>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Grid.Style>
                                                <i:Interaction.Triggers>
                                                    <i:EventTrigger EventName="MouseLeftButtonDown">
                                                        <i:InvokeCommandAction
                                                        Command="{Binding Source={StaticResource MainViewModel}, Path=SetSelectedSectionCommand}"
                                                        CommandParameter="{Binding LinkedSection}" />
                                                        <i:InvokeCommandAction
                                                        Command="{Binding Source={StaticResource MainViewModel}, Path=SetSelectedSubFeatureCommand}"
                                                        CommandParameter="{Binding}" />
                                                    </i:EventTrigger>
                                                    <i:EventTrigger EventName="MouseEnter">
                                                        <i:InvokeCommandAction
                                                        Command="{Binding Source={StaticResource MainViewModel}, Path=SetSectionUnderMouseCommand}"
                                                        CommandParameter="{Binding LinkedSection}" />
                                                    </i:EventTrigger>
                                                    <i:EventTrigger EventName="MouseEnter">
                                                        <i:InvokeCommandAction
                                                        Command="{Binding Source={StaticResource MainViewModel}, Path=SetSubFeatureUnderMouseCommand}"
                                                        CommandParameter="{Binding}" />
                                                    </i:EventTrigger>
                                                </i:Interaction.Triggers>
                                                <Grid.InputBindings>
                                                    <MouseBinding Gesture="LeftDoubleClick"
                                                              Command="{Binding Source={StaticResource MainViewModel}, 
                                        Path=OpenDialogViewCommand}"
                                                              CommandParameter="{Binding 
                                                    Converter={StaticResource ShaftItemToParametersWindowTypeConverter}}" />
                                                </Grid.InputBindings>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="0.96*" />
                                                    <ColumnDefinition Width="0.04*" />
                                                </Grid.ColumnDefinitions>
                                                <DockPanel Grid.Column="0">
                                                    <Border BorderThickness="1" Background="WhiteSmoke" Width="30"
                                                        Height="30"
                                                        BorderBrush="DeepSkyBlue" Margin="0,0.3,0,0.3">
                                                        <Image Width="26"
                                                           Height="26">
                                                            <Image.Style>
                                                                <Style TargetType="Image">
                                                                    <Style.Triggers>
                                                                        <DataTrigger
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type subFeatures:ThroughHoleSubFeature}">
                                                                            <Setter Property="Source"
                                                                                Value="../Assets/Icons/throughHoleIcon.png" />
                                                                        </DataTrigger>
                                                                        <MultiDataTrigger>
                                                                            <MultiDataTrigger.Conditions>
                                                                                <Condition
                                                                                Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                                Value="{x:Type subFeatures:RetainingRingGrooveSubFeature}" />
                                                                                <Condition
                                                                                Binding="{Binding Path=LinkedSection.IsBore}"
                                                                                Value="True" />
                                                                            </MultiDataTrigger.Conditions>
                                                                            <Setter Property="Source"
                                                                                Value="../Assets/Icons/retainingRingBore.png" />
                                                                        </MultiDataTrigger>
                                                                        <MultiDataTrigger>
                                                                            <MultiDataTrigger.Conditions>
                                                                                <Condition
                                                                                Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                                Value="{x:Type subFeatures:RetainingRingGrooveSubFeature}" />
                                                                                <Condition
                                                                                Binding="{Binding Path=LinkedSection.IsBore}"
                                                                                Value="False" />
                                                                            </MultiDataTrigger.Conditions>
                                                                            <Setter Property="Source"
                                                                                Value="../Assets/Icons/retainingRingIcon.png" />
                                                                        </MultiDataTrigger>
                                                                        <DataTrigger
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type subFeatures:KeywayGrooveSubFeature}">
                                                                            <Setter Property="Source"
                                                                                Value="../Assets/Icons/keywayGrooveFeatureIcon.png" />
                                                                        </DataTrigger>
                                                                        <DataTrigger
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type subFeatures:WrenchSubFeature}">
                                                                            <Setter Property="Source"
                                                                                Value="../Assets/Icons/wrenchOpeningIcon.png" />
                                                                        </DataTrigger>
                                                                        <DataTrigger
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type subFeatures:ReliefDSISubFeature}">
                                                                            <Setter Property="Source"
                                                                                Value="../Assets/Icons/reliefDIcon.png" />
                                                                        </DataTrigger>
                                                                        <DataTrigger
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type subFeatures:GrooveASubFeature}">
                                                                            <Setter Property="Source"
                                                                                Value="../Assets/Icons/grooveAIcon.png" />
                                                                        </DataTrigger>
                                                                        <DataTrigger
                                                                        Binding="{Binding Converter={StaticResource ObjectToTypeConverter}}"
                                                                        Value="{x:Type subFeatures:GrooveBSubFeature}">
                                                                            <Setter Property="Source"
                                                                                Value="../Assets/Icons/grooveBIcon.png" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Image.Style>
                                                        </Image>
                                                    </Border>
                                                    <TextBlock Margin="2,0,0,0" VerticalAlignment="Center"
                                                           Text="{Binding Converter={StaticResource SubFeatureToNameConverter}}" />
                                                </DockPanel>
                                                <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                                    <i:Interaction.Behaviors>
                                                        <behaviors:ShowHideUIElementBehavior AncestorGridLevel="1" />
                                                    </i:Interaction.Behaviors>
                                                    <ContentControl Content="{StaticResource OpenParametersDialogButton}" />
                                                    <ContentControl Content="{StaticResource RemoveItemButton}" />
                                                </StackPanel>
                                            </Grid>
                                        </DataTemplate>
                                    </HierarchicalDataTemplate.ItemTemplate>
                                </HierarchicalDataTemplate>
                            </TreeView.ItemTemplate>
                        </TreeView>
                </Grid>
            </GroupBox>

            <ListBox Grid.Row="0" Grid.Column="1" Margin="0,9.5,5,2.4" Name="DimensionPanel"
                     Style="{StaticResource DimensionsPanelStyle}"
                     ItemsSource="{Binding Source={StaticResource Shaft}, Path=Sections}">
                <i:Interaction.Behaviors>
                    <behaviors:SectionsItemsControlRefreshBehavior />
                </i:Interaction.Behaviors>
                <ListBox.ItemContainerStyle>
                    <Style BasedOn="{StaticResource ListBoxItemStyle1}" TargetType="ListBoxItem">
                        <Setter Property="Focusable" Value="False" />
                        <Setter Property="IsSelected" Value="False" />
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        <Style.Triggers>
                            <DataTrigger Value="True">
                                <DataTrigger.Binding>
                                    <MultiBinding Converter="{StaticResource SectionEqualityComparer}">
                                        <Binding Source="{StaticResource MainViewModel}"
                                                 Path="SelectedSection" />
                                        <Binding Path="." />
                                    </MultiBinding>
                                </DataTrigger.Binding>
                                <Setter Property="IsSelected" Value="True" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ListBox.ItemContainerStyle>
                <ListBox.Template>
                    <ControlTemplate>
                        <Border BorderBrush="DeepSkyBlue" BorderThickness="1.5">
                            <ScrollViewer CanContentScroll="False" VerticalScrollBarVisibility="Auto">
                                <Grid Margin="1,0,0,3" HorizontalAlignment="Stretch">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Padding="7,7,0,7"
                                            Margin="-0.8,0,0,0"
                                            Background="#DBDBDB" BorderThickness="0">
                                        <TextBlock Text="Dimensions" FontWeight="SemiBold" FontSize="12" />
                                    </Border>
                                    <TextBlock Grid.Row="1" Grid.Column="0" Margin="5,5,0,5" Text="Shaft Lenght"
                                               HorizontalAlignment="Left" />
                                    <TextBlock Grid.Row="1" Grid.Column="1" Margin="0,5,15,1"
                                               Text="{Binding ShaftLength, StringFormat={}{0:0.###} mm}"
                                               HorizontalAlignment="Right" />
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Bore L"
                                               HorizontalAlignment="Left"
                                               Margin="5,0,0,5" />
                                    <TextBlock Grid.Row="2" Grid.Column="1" Margin="0,1,15,1"
                                               Text="{Binding BoreLeftLength, StringFormat={}{0:0.###} mm}"
                                               HorizontalAlignment="Right" />
                                    <TextBlock Grid.Row="3" Grid.Column="0" Margin="5,0,0,5" Text="Bore R"
                                               HorizontalAlignment="Left" />
                                    <TextBlock Grid.Row="3" Grid.Column="1" Margin="0,1,15,1"
                                               Text="{Binding BoreRightLength, StringFormat={}{0:0.###} mm}"
                                               HorizontalAlignment="Right" />
                                
                                    <ItemsPresenter Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2" />
                            </Grid>
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </ListBox.Template>
                <ListBox.Resources>
                    <Style x:Key="ListBoxItemGridStyle" TargetType="Grid">
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="Margin" Value="0,2.5,0,2.5" />
                        <Setter Property="Width">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource SumConverter}">
                                    <Binding
                                        RelativeSource="{RelativeSource FindAncestor, AncestorType=ScrollContentPresenter, AncestorLevel=1}"
                                        Path="ActualWidth" />
                                    <Binding
                                        RelativeSource="{RelativeSource FindAncestor, AncestorType=ListBoxItem, AncestorLevel=1}"
                                        Converter="{StaticResource ParentCountConverter}" />
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                    </Style>
                    <vc:ItemsControlItemToIndexConverter x:Key="ItemToIndexConverter" />
                    <DataTemplate DataType="{x:Type sections:CylinderSection}" x:Shared="False">
                        <Grid Style="{StaticResource ListBoxItemGridStyle}">
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="MouseLeftButtonDown">
                                    <i:InvokeCommandAction
                                        Command="{Binding Source={StaticResource MainViewModel}, Path=SectionClickCommand}"
                                        CommandParameter="{Binding}" />
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="0.25*" />
                                <ColumnDefinition Width="0.75*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Margin="3,1,0,2"
                                       FontWeight="Bold">
                                <TextBlock.Text>
                                    <Binding RelativeSource="{RelativeSource FindAncestor, AncestorType=ListBoxItem}"
                                             Mode="OneWay"
                                             StringFormat="{}{0}. Cylinder">
                                        <Binding.Converter>
                                            <vc:ChainConverter>
                                                <vc:ItemsControlItemToIndexConverter
                                                    Parameter="{x:Reference DimensionPanel}" />
                                                <vc:MathConverter Parameter="@VALUE+1" />
                                            </vc:ChainConverter>
                                        </Binding.Converter>
                                    </Binding>
                                </TextBlock.Text>
                            </TextBlock>
                            <Line Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="1"
                                  X1="0"
                                  X2="{Binding RelativeSource={RelativeSource AncestorType=Grid}, Path=ActualWidth}"
                                  Y1="0" Y2="0"
                                  Stroke="DeepSkyBlue" StrokeThickness="1.1" />
                            <TextBlock Grid.Row="2" Grid.Column="0" Margin="1" HorizontalAlignment="Left" Text="D" />
                            <TextBlock Grid.Row="2" Grid.Column="1" Margin="1" HorizontalAlignment="Right"
                                       Text="{Binding Path=Diameter, StringFormat={}{0:0.###} mm}" />
                            <TextBlock Grid.Row="3" Grid.Column="0" Margin="1" HorizontalAlignment="Left" Text="L" />
                            <TextBlock Grid.Row="3" Grid.Column="1" Margin="1" HorizontalAlignment="Right"
                                       Text="{Binding Path=Length, StringFormat={}{0:0.###} mm}" />
                        </Grid>
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type sections:ConeSection}">
                        <Grid Style="{StaticResource ListBoxItemGridStyle}">
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="MouseLeftButtonDown">
                                    <i:InvokeCommandAction
                                        Command="{Binding Source={StaticResource MainViewModel}, 
                                                        Path=SectionClickCommand}"
                                        CommandParameter="{Binding}" />
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="0.25*" />
                                <ColumnDefinition Width="0.75*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Margin="3,1,0,2"
                                       FontWeight="Bold">
                                <TextBlock.Text>
                                    <Binding RelativeSource="{RelativeSource FindAncestor, AncestorType=ListBoxItem}"
                                             Mode="OneWay"
                                             StringFormat="{}{0}. Cone">
                                        <Binding.Converter>
                                            <vc:ChainConverter>
                                                <vc:ItemsControlItemToIndexConverter
                                                    Parameter="{x:Reference DimensionPanel}" />
                                                <vc:MathConverter Parameter="@VALUE+1" />
                                            </vc:ChainConverter>
                                        </Binding.Converter>
                                    </Binding>
                                </TextBlock.Text>
                            </TextBlock>
                            <Line Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="1"
                                  X1="0"
                                  X2="{Binding RelativeSource={RelativeSource AncestorType=Grid}, Path=ActualWidth}"
                                  Y1="0" Y2="0"
                                  Stroke="DeepSkyBlue" StrokeThickness="1.1" />
                            <TextBlock Grid.Row="2" Grid.Column="0" Margin="1" HorizontalAlignment="Left">
                                <Run Text="D" />
                                <Run Text="1" FontSize="9" BaselineAlignment="Subscript" />
                            </TextBlock>
                            <TextBlock Grid.Row="2" Grid.Column="1" Margin="1" HorizontalAlignment="Right"
                                       Text="{Binding Path=Diameter1, StringFormat={}{0:0.###} mm}" />
                            <TextBlock Grid.Row="3" Grid.Column="0" Margin="1" HorizontalAlignment="Left">
                                <Run Text="D" />
                                <Run Text="2" FontSize="9" BaselineAlignment="Subscript" />
                            </TextBlock>
                            <TextBlock Grid.Row="3" Grid.Column="1" Margin="1" HorizontalAlignment="Right"
                                       Text="{Binding Path=Diameter2, StringFormat={}{0:0.###} mm}" />
                            <TextBlock Grid.Row="4" Grid.Column="0" Margin="1" HorizontalAlignment="Left" Text="L" />
                            <TextBlock Grid.Row="4" Grid.Column="1" Margin="1" HorizontalAlignment="Right"
                                       Text="{Binding Path=Length, StringFormat={}{0:0.###} mm}" />
                        </Grid>
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type sections:PolygonSection}">
                        <Grid Style="{StaticResource ListBoxItemGridStyle}">
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="MouseLeftButtonDown">
                                    <i:InvokeCommandAction
                                        Command="{Binding Source={StaticResource MainViewModel}, 
                                                        Path=SectionClickCommand}"
                                        CommandParameter="{Binding}" />
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="0.25*" />
                                <ColumnDefinition Width="0.75*" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Margin="3,1,0,2"
                                       FontWeight="Bold">
                                <TextBlock.Text>
                                    <Binding RelativeSource="{RelativeSource FindAncestor, AncestorType=ListBoxItem}"
                                             Mode="OneWay"
                                             StringFormat="{}{0}. Polygon">
                                        <Binding.Converter>
                                            <vc:ChainConverter>
                                                <vc:ItemsControlItemToIndexConverter
                                                    Parameter="{x:Reference DimensionPanel}" />
                                                <vc:MathConverter Parameter="@VALUE+1" />
                                            </vc:ChainConverter>
                                        </Binding.Converter>
                                    </Binding>
                                </TextBlock.Text>
                            </TextBlock>
                            <Line Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="1"
                                  X1="0"
                                  X2="{Binding RelativeSource={RelativeSource AncestorType=Grid}, Path=ActualWidth}"
                                  Y1="0" Y2="0"
                                  Stroke="DeepSkyBlue" StrokeThickness="1.1" />
                            <TextBlock Grid.Row="2" Grid.Column="0" Margin="1" HorizontalAlignment="Left">
                                <Run Text="D" />
                                <Run Text="out" FontSize="9" BaselineAlignment="Subscript" />
                            </TextBlock>
                            <TextBlock Grid.Row="2" Grid.Column="1" Margin="1" HorizontalAlignment="Right"
                                       Text="{Binding Path=CircumscribedCircleDiameter, StringFormat={}{0:0.###} mm}" />
                            <TextBlock Grid.Row="3" Grid.Column="0" Margin="1" HorizontalAlignment="Left">
                                <Run Text="D" />
                                <Run Text="in" FontSize="9" BaselineAlignment="Subscript" />
                            </TextBlock>
                            <TextBlock Grid.Row="3" Grid.Column="1" Margin="1" HorizontalAlignment="Right"
                                       Text="{Binding Path=InscribedCircleDiameter, StringFormat={}{0:0.###} mm}" />
                            <TextBlock Grid.Row="4" Grid.Column="0" Margin="1" HorizontalAlignment="Left" Text="L" />
                            <TextBlock Grid.Row="4" Grid.Column="1" Margin="1" HorizontalAlignment="Right"
                                       Text="{Binding Path=Length, StringFormat={}{0:0.###} mm}" />
                            <TextBlock Grid.Row="5" Grid.Column="0" Margin="1" HorizontalAlignment="Left" Text="N" />
                            <TextBlock Grid.Row="5" Grid.Column="1" Margin="1" HorizontalAlignment="Right"
                                       Text="{Binding Path=NumberOfEdges, StringFormat={}{0} ul}" />
                            <TextBlock Grid.Row="6" Grid.Column="0" Margin="1" HorizontalAlignment="Left" Text="&#945;" />
                            <TextBlock Grid.Row="6" Grid.Column="1" Margin="1" HorizontalAlignment="Right"
                                       Text="{Binding Path=SectionAngle, StringFormat={}{0:0.##} deg}" />
                            <TextBlock Grid.Row="7" Grid.Column="0" Margin="1" HorizontalAlignment="Left" Text="D" />
                            <TextBlock Grid.Row="7" Grid.Column="1" Margin="1" HorizontalAlignment="Right"
                                       Text="{Binding Path=CircumscribedCircleDiameter, StringFormat={}{0:0.###} mm}" />
                        </Grid>
                    </DataTemplate>
                </ListBox.Resources>
            </ListBox>

            <DockPanel Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="1" Margin="5,3,6,5">
                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                    <Button Content="Cancel" Margin="0,0,10,0" FontSize="12" Width="65" Height="20">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="Click">
                                <ie:ChangePropertyAction TargetName="ThisWindow" PropertyName="Visibility"
                                                         Value="Collapsed" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </Button>
                    <Button Content="Build" FontSize="12" Width="65" Height="20" Command="{Binding BuildShaftCommand}"
                            ToolTipService.ShowOnDisabled="True" Name="BuildButton">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                <Setter Property="ToolTipService.ShowDuration" Value="7000" />
                                <Style.Triggers>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition
                                                Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=IsEnabled}"
                                                Value="False" />
                                            <Condition
                                                Binding="{Binding Source={StaticResource MainViewModel}, Path=ShaftHasFeatureErrors}"
                                                Value="True" />
                                        </MultiDataTrigger.Conditions>
                                        <MultiDataTrigger.Setters>
                                            <Setter Property="ToolTip">
                                                <Setter.Value>
                                                    <StackPanel>
                                                        <TextBlock FontSize="15" Text="The shaft has feature errors" />
                                                        <TextBlock FontSize="15" Text="See features indicated by red" />
                                                    </StackPanel>
                                                </Setter.Value>
                                            </Setter>
                                        </MultiDataTrigger.Setters>
                                    </MultiDataTrigger>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition
                                                Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=IsEnabled}"
                                                Value="False" />
                                            <Condition
                                                Binding="{Binding Source={StaticResource MainViewModel}, Path=NoSectionsHaveBeenSet}"
                                                Value="True" />
                                        </MultiDataTrigger.Conditions>
                                        <MultiDataTrigger.Setters>
                                            <Setter Property="ToolTip">
                                                <Setter.Value>
                                                    <TextBlock FontSize="15" Text="No sections have been set" />
                                                </Setter.Value>
                                            </Setter>
                                        </MultiDataTrigger.Setters>
                                    </MultiDataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </DockPanel>
        </Grid>
    </extensions:BusyDecorator>
</Window>